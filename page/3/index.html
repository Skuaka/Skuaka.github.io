<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Skuaka">


    
    


<meta name="description" content="For you, a thousand times over.">
<meta name="keywords" content="skuaka">
<meta property="og:type" content="website">
<meta property="og:title" content="Skuaka">
<meta property="og:url" content="http://skuaka.cn/page/3/index.html">
<meta property="og:site_name" content="Skuaka">
<meta property="og:description" content="For you, a thousand times over.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Skuaka">
<meta name="twitter:description" content="For you, a thousand times over.">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Skuaka" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/avatar.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Skuaka</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Skuaka</a></h1>
        </hgroup>

        
        <p class="header-subtitle">For you, a thousand times over.</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>Menu</li>
                        <li>Tags</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">Home</a></li>
                        
                            <li><a href="/archives/">Archives</a></li>
                        
                            <li><a href="/tags/">Tags</a></li>
                        
                            <li><a href="/about/">about</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:skuaka@icloud.com" title="Email"></a>
                            
                                <a class="fa bilibili" href="https://space.bilibili.com/5006495" title="bilibili"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCIE/">CCIE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDos/">DDos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DTD/">DTD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DoNotStarve/">DoNotStarve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dreamweaver/">Dreamweaver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Job/">Job</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Macos/">Macos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Makefile/">Makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MetaProgram/">MetaProgram</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mp3/">Mp3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Op-System/">Op-System</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Perl/">Perl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QT/">QT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberrypi/">Raspberrypi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLserver/">SQLserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Security/">Security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tcp-ip/">Tcp/ip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vultr/">Vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wifi/">Wifi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wireshark/">Wireshark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML/">XML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/base64/">base64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc-gdb/">gcc,gdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/robotframework/">robotframework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/steamcmd/">steamcmd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/travis/">travis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unp/">unp</a></li></ul>
                    </div>
                </section>
                
                
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Skuaka</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Skuaka</a></h1>
            </hgroup>
            
            <p class="header-subtitle">For you, a thousand times over.</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/archives/">Archives</a></li>
                
                    <li><a href="/tags/">Tags</a></li>
                
                    <li><a href="/about/">about</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:skuaka@icloud.com" title="Email"></a>
                            
                                <a class="fa bilibili" target="_blank" href="https://space.bilibili.com/5006495" title="bilibili"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me">
</nav>
      <div class="body-wrap">
  
    <article id="post-Linux/Command/grep减号" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/18/Linux/Command/grep减号/" class="article-date">
      <time datetime="2019-05-18T07:13:26.000Z" itemprop="datePublished">2019-05-18</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/18/Linux/Command/grep减号/">shell double-dash(--)作用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="如何grep一个-？"><a href="#如何grep一个-？" class="headerlink" title="如何grep一个 - ？"></a>如何grep一个 <code>-</code> ？</h3><p>起因，想知道如何grep一个中划线。</p>
<p>假如要查找一条命令的某个选项 <code>-a</code> ，即使用引号将 <code>-a</code> 括起来，也会报错。</p>
<p>因为 <code>-</code> (dash键) 是shell选项的前缀。只要它出现shell就会认为接下来跟着的是选项。</p>
<p><strong>两种解决方法</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cmd --<span class="built_in">help</span> | grep -e <span class="string">'-a'</span></span><br><span class="line">$ cmd --<span class="built_in">help</span> | grep -- -a</span><br></pre></td></tr></table></figure>
<p>第一个是grep的正则表达式，第二个是shell语法 <code>--</code>。</p>
<h3 id="double-dash-作用"><a href="#double-dash-作用" class="headerlink" title="double-dash (--) 作用"></a>double-dash (<code>--</code>) 作用</h3><p>来自：<a href="https://unix.stackexchange.com/questions/11376/what-does-double-dash-mean-also-known-as-bare-double-dash" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/11376/what-does-double-dash-mean-also-known-as-bare-double-dash</a></p>
<p>More precisely, a double dash (<code>--</code>) is used in bash built-in commands and many other commands to signify the end of command options, after which only positional parameters are accepted.</p>
<p>Example use: lets say you want to grep a file for the string <code>-v</code> - normally <code>-v</code> will be considered the option to reverse the matching meaning (only show lines that do not match), but with <code>--</code> you can grep for string <code>-v</code> like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -- -v file</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shell/">Shell</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Security/linux服务器入侵检测" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/12/Security/linux服务器入侵检测/" class="article-date">
      <time datetime="2019-05-12T15:19:13.000Z" itemprop="datePublished">2019-05-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/12/Security/linux服务器入侵检测/">linux服务器入侵检测</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>source: <a href="https://bash-prompt.net/guides/server-hacked/" target="_blank" rel="noopener">https://bash-prompt.net/guides/server-hacked/</a></p>
<p>一篇翻译：<a href="https://linux.cn/article-9116-1.html" target="_blank" rel="noopener">https://linux.cn/article-9116-1.html</a></p>
<h1 id="How-To-Tell-If-Your-Linux-Server-Has-Been-Compromised"><a href="#How-To-Tell-If-Your-Linux-Server-Has-Been-Compromised" class="headerlink" title="How To Tell If Your Linux Server Has Been Compromised"></a>How To Tell If Your Linux Server Has Been Compromised</h1><p>A server being compromised or hacked for the purpose of this guide is an unauthorized person or bot logging into the server in order to use it for their own, usually negative ends.</p>
<p>Disclaimer: If your server has been compromised by a state organization like the NSA or a serious criminal group then you will not notice any problems and the following techniques will not register their presence.</p>
<p>However, the majority of compromised servers are carried out by bots i.e. automated attack programs, in-experienced attackers e.g. “script kiddies”, or dumb criminals.</p>
<p>These sorts of attackers will abuse the server for all it’s worth whilst they have access to it and take few precautions to hide what they are doing.</p>
<h2 id="Symptoms-of-a-compromised-server"><a href="#Symptoms-of-a-compromised-server" class="headerlink" title="Symptoms of a compromised server"></a>Symptoms of a compromised server</h2><p>When a server has been compromised by an in-experienced or automated attacker they will usually do something with it that consumes 100% of a resource. This resource will usually be either the CPU for something like crypt-currency mining or email spamming, or bandwidth for launching a DOS attack.</p>
<p>This means that the first indication that something is amiss is that the server is “going slow”. This could manifest in the website serving pages much slower than usual, or email taking many minutes to deliver or send.</p>
<p>So what should you look for?</p>
<h2 id="Check-1-Who’s-currently-logged-in"><a href="#Check-1-Who’s-currently-logged-in" class="headerlink" title="Check 1 - Who’s currently logged in?"></a>Check 1 - Who’s currently logged in?</h2><p>The first thing you should look for is who is currently logged into the server. It is not uncommon to find the attacker actually logged into the server and working on it.</p>
<p>The shell command to do this is <code>w</code>. Running <code>w</code> gives the following output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 08:32:55 up 98 days,  5:43,  2 users,  load average: 0.05, 0.03, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    113.174.161.1    08:26    0.00s  0.03s  0.02s ssh root@coopeaa12</span><br><span class="line">root     pts/1    78.31.109.1      08:26    0.00s  0.01s  0.00s w</span><br></pre></td></tr></table></figure>
<p>One of those IP’s is a UK IP and the second is Vietnamese. That’s probably not a good thing.</p>
<p>Stop and take a breath, don’t panic and simply kill their SSH connection. Unless you can stop then re-entering the server they will do so quickly and quite likely kick you off and stop you getting back in.</p>
<p>Please see the <strong>What should I do if I’ve been compromised</strong> section at the end of this guide no how to proceed if you do find evidence of compromise.</p>
<p>The <code>whois</code> command can be run on IP addresses and will tell you what all the information about the organization that the IP is registered to, including the country.</p>
<h2 id="Check-2-Who-has-logged-in"><a href="#Check-2-Who-has-logged-in" class="headerlink" title="Check 2 - Who has logged in?"></a>Check 2 - Who has logged in?</h2><p>Linux servers keep a record of which users logged in, from what IP, when and for how long. This information is accessed with the <code>last</code> command.</p>
<p>The output looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root     pts/1        78.31.109.1      Thu Nov 30 08:26   still logged in</span><br><span class="line">root     pts/0        113.174.161.1    Thu Nov 30 08:26   still logged in</span><br><span class="line">root     pts/1        78.31.109.1      Thu Nov 30 08:24 - 08:26  (00:01)</span><br><span class="line">root     pts/0        113.174.161.1    Wed Nov 29 12:34 - 12:52  (00:18)</span><br><span class="line">root     pts/0        14.176.196.1     Mon Nov 27 13:32 - 13:53  (00:21)</span><br></pre></td></tr></table></figure>
<p>There is a mix of my UK IP’s and some Vietnamese ones, with the top two still logged in. If you see any IP’s that are not authorized then refer to the final section.</p>
<p>The login history is contained in a text file at <code>~/.bash_history</code> and is therefore easily removable. Often, attackers will simply delete this file to try to cover their tracks. Consequently, if you run <code>last</code> and only see your current login, this is a <strong>Bad Sign</strong>.</p>
<p>If there is no login history be very, very suspicious and continue looking for indications of compromise.</p>
<h2 id="Check-3-Review-the-command-history"><a href="#Check-3-Review-the-command-history" class="headerlink" title="Check 3 - Review the command history"></a>Check 3 - Review the command history</h2><p>This level of attacker will frequently take no precautions to leave no command history so running the <code>history</code> command will show you everything they have done. Be on the lookout for <code>wget</code> or <code>curl</code> commands to download out-of-repo software such as spam bots or crypto miners.</p>
<p>The command history is contained in the <code>~/.bash_history</code> file so some attackers will delete this file to cover what they have done. Just as with the login history, if you run <code>history</code> and don’t see anything then the history file has been deleted. Again this is a <strong>Bad Sign</strong> and you should review the server very carefully.</p>
<h2 id="Check-4-What’s-using-all-the-CPU"><a href="#Check-4-What’s-using-all-the-CPU" class="headerlink" title="Check 4 - What’s using all the CPU?"></a>Check 4 - What’s using all the CPU?</h2><p>The sorts of attackers that you will encounter usually don’t take too many precautions to hide what they are doing. So they will run processes that consume all the CPU. This generally makes it pretty easy to spot them. Simply run <code>top</code> and look at the highest process.</p>
<p>This will also show people exploiting your server without having logged in. This could be, for example, someone using an unprotected form-mail script to relay spam.</p>
<p>If you don’t recognize the top process then either Google its name or investigate what it’s doing with <code>losf</code> or <code>strace</code>.</p>
<p>To use these tools first copy its PID from <code>top</code> and run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -p PID</span><br></pre></td></tr></table></figure>
<p>This will display all the system calls the process is making. It’s a lot of information but looking through it will give you a good idea what’s going on.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof  -p PID</span><br></pre></td></tr></table></figure>
<p>This program will <strong>l</strong>i<strong>s</strong>t the <strong>o</strong>pen <strong>f</strong>iles that the process has. Again, this will give you a good idea what it’s doing by showing you what files it is accessing.</p>
<h2 id="Check-5-Review-the-all-the-system-processes"><a href="#Check-5-Review-the-all-the-system-processes" class="headerlink" title="Check 5 - Review the all the system processes"></a>Check 5 - Review the all the system processes</h2><p>If an unauthorized process is not consuming enough CPU to get listed noticeably on <code>top</code> it will still get displayed in a full process listing with <code>ps</code>. My proffered command is <code>ps auxf</code> for providing the most information clearly.</p>
<p>You should be looking for any processes that you don’t recognize. The more times you run <code>ps</code> on your servers (which is a good habit to get into) the more obvious an alien process will stand out.</p>
<h2 id="Check-6-Review-network-usage-by-process"><a href="#Check-6-Review-network-usage-by-process" class="headerlink" title="Check 6 - Review network usage by process"></a>Check 6 - Review network usage by process</h2><p>The command <code>iftop</code> functions like <code>top</code> to show a ranked list of processes that are sending and receiving network data along with their source and destination. A process like a DOS attack or spam bot will immediately show itself at the top of the list.</p>
<h2 id="Check-7-What-processes-are-listening-for-network-connections"><a href="#Check-7-What-processes-are-listening-for-network-connections" class="headerlink" title="Check 7 - What processes are listening for network connections?"></a>Check 7 - What processes are listening for network connections?</h2><p>Often an attacker will install a program that doesn’t do anything except listen on the network port for instructions. This does not consume CPU or bandwidth whilst it is waiting so can get overlooked in the <code>top</code> type commands.</p>
<p>The commands <code>lsof</code> and <code>netstat</code> will both list all networked processes. I use them with the following options:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof -i</span><br><span class="line">netstat -plunt</span><br></pre></td></tr></table></figure>
<p>You should look for any process that is listed as in the <code>LISTEN</code> or <code>ESTABLISHED</code> status as these processes are either waiting for a connection (LISTEN) or have a connection open (ESTABLISHED). If you don’t recognize these processes use <code>strace</code> or <code>lsof</code> to try to see what they are doing.</p>
<h2 id="What-should-I-do-if-I’ve-been-compromised"><a href="#What-should-I-do-if-I’ve-been-compromised" class="headerlink" title="What should I do if I’ve been compromised?"></a>What should I do if I’ve been compromised?</h2><p>The first thing to do is not to panic, especially if the attacker is currently logged in. You need to be able to take back control of the machine before the attacker is aware that you know about them. If they realize you know about them they may well lock you out of your server and start destroying any assets out of spite.</p>
<p>If you are not very technical then simply shut down the server. Either from the server itself with <code>shutdown -h now</code> or <code>systemctl poweroff</code>. Or log into your hosting provider’s control panel and shut down the server. Once it’s powered off you can work on the needed firewall rules and consult with your provider in your own time.</p>
<p>If you’re feeling a bit more confident and your hosting provider has an upstream firewall then create and enable the following two rules in this order:</p>
<ol>
<li>Allow SSH traffic from only your IP address.</li>
<li>Block <strong>everything</strong> else, not just SSH but every protocol on every port.</li>
</ol>
<p>This will immediately kill their SSH session and give only you access to the server.</p>
<p>If you don’t have access to an upstream firewall then you will have to create and enable these firewall rules on the server itself and then, when they are in place kill the attacker’s ssh session with the <code>kill</code> command.</p>
<p>A final method, where available, is to log into the server via an out-of-band connection such as the serial console and stop networking with <code>systemctl stop network.service</code>. This will completely stop any network access so you can now enable the firewall rules in your own time.</p>
<p>Once you have regained control of the server <strong>do not trust it</strong>.</p>
<p>Do not attempt to fix things up and continue using the server. You can never be sure what the attacker did and so you can never sure the server is secure.</p>
<p>The <strong>only sensible</strong> course of action is to copy off all the data that you need and start again from a fresh install.</p>
<h1 id="Fin"><a href="#Fin" class="headerlink" title="Fin"></a>Fin</h1>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Security/">Security</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Security/">Security</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Network/IO/libevent进阶" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/27/Network/IO/libevent进阶/" class="article-date">
      <time datetime="2019-04-27T14:12:13.000Z" itemprop="datePublished">2019-04-27</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/27/Network/IO/libevent进阶/">libevent进阶</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="libevent进阶"><a href="#libevent进阶" class="headerlink" title="libevent进阶"></a>libevent进阶</h2><p>之前一篇学了libevent基础，之后陆陆续续用到了一些进阶知识，遂另起此篇记录。</p>
<h3 id="libevent多线程"><a href="#libevent多线程" class="headerlink" title="libevent多线程"></a>libevent多线程</h3><p>libevent 默认不开启多线程支持，所以在其他线程对 event 进行操作时无法唤醒事件。</p>
<p>这里总结一下 libevent 在多线程下最简单的使用需要添加的内容。</p>
<hr>
<ul>
<li><p>头文件 + <code>&lt;event2/thread.h&gt;</code></p>
</li>
<li><p>event_base 创建前 + <code>evthread_use_pthreads();</code></p>
</li>
<li><p>// event_base 创建后 + <code>evthread_make_base_notifiable(ev_base);</code></p>
<p>Make sure it’s safe to tell an event base to wake up from another thread or a signal handler.</p>
<p>如果不添加这句程序也能正常运行，我暂时认为这是一种确保，即如果返回-1表明失败，否则无用。</p>
</li>
<li><p>event 创建时 + <code>BEV_OPT_THREADSAFE</code></p>
</li>
<li><p>链接库 + <code>-levent_pthreads</code></p>
</li>
</ul>
<hr>
<h3 id="libevent-SSL"><a href="#libevent-SSL" class="headerlink" title="libevent+SSL"></a>libevent+SSL</h3><h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Network/">Network</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Network/">Network</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Programming/守护进程的创建" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/25/Linux/Programming/守护进程的创建/" class="article-date">
      <time datetime="2019-04-25T11:39:20.000Z" itemprop="datePublished">2019-04-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/Linux/Programming/守护进程的创建/">守护进程的创建</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>转自：<a href="http://blog.chinaunix.net/uid-25365622-id-3055635.html" target="_blank" rel="noopener">http://blog.chinaunix.net/uid-25365622-id-3055635.html</a></p>
<h2 id="守护进程的创建"><a href="#守护进程的创建" class="headerlink" title="守护进程的创建"></a>守护进程的创建</h2><p>守护进程（Daemon）是运行在后台的一种特殊进程。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。</p>
<ol>
<li><p>使进程在后台运行</p>
<p>创建子进程父进程退出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((pid = fork())&gt;<span class="number">0</span>)</span><br><span class="line">   <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(pid&lt;<span class="number">0</span>) &#123;</span><br><span class="line">    perror(<span class="string">"fail to fork"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>脱离控制终端，登录会话和进程组（创建新会话）</p>
<p>进程属于一个进程组，进程组号（GID）就是进程组长的进程号（PID）。登录会话可以包含多个进程组。这些进程组共享一个控制终端。这个控制终端通常是创建进程的登录终端。 控制终端，登录会话和进程组通常是从父进程继承下来的。我们的目的就是要摆脱它们，使之不受它们的影响。方法是在第1点的基础上，调用setsid()使进程成为会话组长。</p>
<p>说明：当进程是会话组长时setsid()调用失败。但第一点已经保证进程不是会话组长。</p>
<p>setsid()调用成功后，进程成为新的会话组长和新的进程组长，并与原来的登录会话和进程组脱离。由于会话过程对控制终端的独占性，进程同时与控制终端脱离。</p>
<p>The <code>setsid()</code> function creates a new session.  The calling process is the session leader of the new session, is the process group leader of a new process group and has no controlling terminal.</p>
</li>
<li><p>禁止进程重新打开控制终端 (非必要)</p>
<p>现在，进程已经成为无终端的会话组长。但它可以重新申请打开一个控制终端。可以通过使进程不再成为会话组长来禁止进程重新打开控制终端： </p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(pid=fork()) </span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//结束第一子进程，第二子进程继续（第二子进程不再是会话组长）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭所有文件描述符</p>
<p>进程从创建它的父进程那里继承了打开的文件描述符。如不关闭，将会浪费系统资源，造成进程所在的文件系统无法卸下以及引起无法预料的错误:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;=getdtablesize(); i++)</span><br><span class="line">		close(i);</span><br></pre></td></tr></table></figure>
</li>
<li><p>改变当前工作目录 </p>
<p>进程活动时，其工作目录所在的文件系统不能卸下。一般需要将工作目录改变到根目录<code>/</code>。对于需要转储核心，写运行日志的进程将工作目录改变到特定目录如<code>/tmp</code>:</p>
<p><code>chdir(&quot;/&quot;) ;</code></p>
</li>
<li><p>重设权限掩码</p>
<p>进程从创建它的父进程那里继承了文件创建掩码。它可能修改守护进程所创建的文件的存取位。为防止这一点，将文件创建掩码清除：</p>
<p><code>umask(0);</code></p>
</li>
<li><p>处理SIGCHLD信号 (非必要)</p>
<p>处理SIGCHLD信号并不是必须的。但对于某些进程，特别是服务器进程往往在请求到来时生成子进程处理请求。如果父进程不等待子进程结束，子进程将成为僵尸进程（zombie）从而占用系统资源。如果父进程等待子进程结束，将增加父进程的负担，影响服务器进程的并发性能。在Linux下可以简单地将 SIGCHLD信号的操作设为SIG_IGN。 </p>
<p><code>signal(SIGCHLD,SIG_IGN);</code> </p>
<p>这样，内核在子进程结束时不会产生僵尸进程。这一点与BSD4不同，BSD4下必须显式等待子进程结束才能释放僵尸进程。</p>
</li>
</ol>
<p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*name: init_deamon.c</span></span><br><span class="line"><span class="comment"> *function:创建一个守护进程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/param.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt; </span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_deamon</span><span class="params">(<span class="keyword">void</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">int</span> pid; </span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 处理SIGCHLD信号。处理SIGCHLD信号并不是必须的。但对于某些进程，特别是服务器进程往往在请求到来时生成子进程处理请求。如果父进程不等待子进程结束，子进程将成为僵尸进程（zombie）从而占用系统资源。*/</span></span><br><span class="line">    <span class="keyword">if</span>(signal(SIGCHLD,SIG_IGN) == SIG_ERR)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Cant signal in init_daemon."</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pid=fork()) </span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//是父进程，结束父进程 </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid&lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);<span class="comment">//fork失败，退出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//是第一子进程，后台继续执行</span></span><br><span class="line">    setsid();<span class="comment">//第一子进程成为新的会话组长和进程组长,并与控制终端分离</span></span><br><span class="line">    <span class="keyword">if</span>(pid=fork())</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//是第一子进程，结束第一子进程 </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid&lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);<span class="comment">//fork失败，退出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//是第二子进程，不再是会话组长</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt; getdtablesize();++i)<span class="comment">//关闭打开的文件描述符</span></span><br><span class="line">        close(i); </span><br><span class="line">    chdir(<span class="string">"/tmp"</span>);<span class="comment">//改变工作目录到/tmp</span></span><br><span class="line">    umask(<span class="number">0</span>);<span class="comment">//重设文件创建掩码</span></span><br><span class="line">    <span class="keyword">return</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* name :test.c</span></span><br><span class="line"><span class="comment"> * function :调用init_deamon函数使进程变成守护进程，然后每一秒向/tmp目录下的print_time文件打印当前时间</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_deamon</span><span class="params">(<span class="keyword">void</span>)</span></span>;<span class="comment">//守护进程初始化函数 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    FILE *fp; </span><br><span class="line">    <span class="keyword">time_t</span> t; </span><br><span class="line">    init_deamon();<span class="comment">//初始化为Daemon </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)<span class="comment">//每隔一分钟向test.log报告运行状态 </span></span><br><span class="line">    &#123; </span><br><span class="line">        sleep(<span class="number">1</span>);<span class="comment">//睡眠一秒钟 </span></span><br><span class="line">        <span class="keyword">if</span>((fp=fopen(<span class="string">"print_time"</span>,<span class="string">"a"</span>)) &gt;=<span class="number">0</span>) </span><br><span class="line">        &#123; </span><br><span class="line">            t=time(<span class="number">0</span>); </span><br><span class="line">            <span class="built_in">fprintf</span>(fp,<span class="string">"The time right now is : %s"</span>,asctime(localtime(&amp;t))); </span><br><span class="line">            fclose(fp); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C-C++/Concept-gcc/attribute-packed" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/25/C-C++/Concept-gcc/attribute-packed/" class="article-date">
      <time datetime="2019-04-25T06:43:11.000Z" itemprop="datePublished">2019-04-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/C-C++/Concept-gcc/attribute-packed/">__attribute__</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>学习自：<a href="http://blog.chinaunix.net/uid-25768133-id-3485479.html" target="_blank" rel="noopener">http://blog.chinaunix.net/uid-25768133-id-3485479.html</a></p>
<h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>GNU C的一大特色就是<code>__attribute__</code>机制。<code>__attribute__</code>可以设置函数属性（Function Attribute）、变量属性（Variable Attribute）和类型属性（Type Attribute）。</p>
<p><strong>语法格式</strong>：</p>
<p><code>__attribute__ ((attribute-list))</code></p>
<p>其位置约束：放于声明的尾部“；”之前。</p>
<h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><h4 id="attribute-packed"><a href="#attribute-packed" class="headerlink" title="__attribute__((packed))"></a><code>__attribute__((packed))</code></h4><p>作用：让编译器取消结构在编译过程中的优化对齐，按照实际占用字节数进行对齐，即对变量是一字节对齐，对域（field）是位对齐。。</p>
<p>这是GCC特有的语法，gcc默认是非紧凑模式的。</p>
<p>在TC下：<code>struct my{ char ch; int a;}</code> sizeof(int)=2;sizeof(my)=3;（紧凑模式）</p>
<p>在GCC下：<code>struct my{ char ch; int a;}</code> sizeof(int)=4;sizeof(my)=8;（非紧凑模式）</p>
<p>在GCC下：<code>struct my{ char ch; int a;}__attrubte__ ((packed))</code> sizeof(int)=4;sizeof(my)=5</p>
<h4 id="attribute-noreturn"><a href="#attribute-noreturn" class="headerlink" title="__attribute__((noreturn))"></a><code>__attribute__((noreturn))</code></h4><p>告诉编译器这个函数不会返回给调用者，以便编译器在优化时去掉不必要的函数返回代码。</p>
<h3 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h3><p>以后遇到了再添加。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/System/SIGINT-SIGTERM-SIGKILL区别" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/24/Linux/System/SIGINT-SIGTERM-SIGKILL区别/" class="article-date">
      <time datetime="2019-04-24T12:31:15.000Z" itemprop="datePublished">2019-04-24</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/24/Linux/System/SIGINT-SIGTERM-SIGKILL区别/">SIGINT SIGTERM SIGKILL区别</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="SIGINT-SIGTERM-SIGKILL区别"><a href="#SIGINT-SIGTERM-SIGKILL区别" class="headerlink" title="SIGINT SIGTERM SIGKILL区别"></a>SIGINT SIGTERM SIGKILL区别</h3><p>参考：<a href="https://www.cnblogs.com/alexyuyu/articles/3853583.html" target="_blank" rel="noopener">https://www.cnblogs.com/alexyuyu/articles/3853583.html</a></p>
<p>三者都是结束/终止进程运行。</p>
<ol>
<li><p>SIGINT SIGTERM区别</p>
<p>前者与字符ctrl+c关联，后者没有任何控制字符关联。</p>
<p>SIGINT 会被当前进程树接收到，也就是说，不仅当前进程会收到信号，它的子进程也会收到。</p>
<p>SIGTERM 只有当前进程收到信号，子进程不会收到。如果当前进程被kill了，那么它的子进程的父进程将会是 init 进程。</p>
</li>
<li><p>SIGTERM SIGKILL的区别</p>
<p>前者可以被阻塞、处理和忽略，但是后者不可以。</p>
<p>KILL 命令的默认参数发送的信号就是 SIGTERM。</p>
<p><code>kill -9 进程号</code> 发送的则是不能被捕获的 SIGKILL。</p>
</li>
</ol>
<p>自己试验：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;                                                                                                                                                    </span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;                                                                         </span><br><span class="line">    fork();                                                                          </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;&#125;                                                                       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_12_centos T]# ./a.out &amp;                                                       </span><br><span class="line">[1] 12831                                                                                </span><br><span class="line">[root@VM_0_12_centos T]# ps                                                              </span><br><span class="line">  PID TTY          TIME CMD                                                              </span><br><span class="line">12538 pts/1    00:00:00 bash                                                             </span><br><span class="line">12831 pts/1    00:00:01 a.out                                                            </span><br><span class="line">12832 pts/1    00:00:01 a.out                                                            </span><br><span class="line">12838 pts/1    00:00:00 ps                                                               </span><br><span class="line">[root@VM_0_12_centos T]# fg                                                              </span><br><span class="line">./a.out                                                                                  </span><br><span class="line">^C                                                                                                                                                </span><br><span class="line">[root@VM_0_12_centos T]# ps                                                              </span><br><span class="line">  PID TTY          TIME CMD                                                              </span><br><span class="line">12538 pts/1    00:00:00 bash                                                             </span><br><span class="line">12881 pts/1    00:00:00 ps</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_12_centos T]# ./a.out &amp;                                                       </span><br><span class="line">[1] 13027                                                                                </span><br><span class="line">[root@VM_0_12_centos T]# ps</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">12538 pts/1    00:00:00 bash</span><br><span class="line">13027 pts/1    00:00:00 a.out</span><br><span class="line">13028 pts/1    00:00:00 a.out</span><br><span class="line">13029 pts/1    00:00:00 ps       </span><br><span class="line">[root@VM_0_12_centos T]# kill -l</span><br><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1</span><br><span class="line">11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR</span><br><span class="line">31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX    </span><br><span class="line">[root@VM_0_12_centos T]# kill -4 13027</span><br><span class="line">[root@VM_0_12_centos T]# ps</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">12538 pts/1    00:00:00 bash</span><br><span class="line">13028 pts/1    00:00:24 a.out</span><br><span class="line">13107 pts/1    00:00:00 ps</span><br><span class="line">[1]+  Illegal instruction     ./a.out</span><br><span class="line">[root@VM_0_12_centos T]# fg                                                              </span><br><span class="line">-bash: fg: current: no such job</span><br></pre></td></tr></table></figure>
<p>可见原来的命令进程被kill后，fork出来的进程变成了非法指令。只能再kill掉。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Mess/趋势科技秋招面经" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/23/Mess/趋势科技秋招面经/" class="article-date">
      <time datetime="2019-04-23T12:57:21.000Z" itemprop="datePublished">2019-04-23</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/23/Mess/趋势科技秋招面经/">趋势科技 Linux C++ 面经</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="趋势科技秋招-Linux-C-面经"><a href="#趋势科技秋招-Linux-C-面经" class="headerlink" title="趋势科技秋招 Linux C++ 面经"></a>趋势科技秋招 Linux C++ 面经</h2><h3 id="一面"><a href="#一面" class="headerlink" title="一面"></a>一面</h3><p>网络相关：</p>
<p>问：TCP 和 IP 分别是哪一层的？</p>
<p>答：略</p>
<p>问：ICMP 是哪一层的，有哪些功能</p>
<p>答：略</p>
<p>问：http 协议的内容</p>
<p>答：先是请求头，然后是一些字段和字段值，然后是数据</p>
<p>问：那 head 和 body 之间是用什么分隔的</p>
<p>答：杠r杠n</p>
<p>问：用http传输一个文件body怎么实现？</p>
<p>答：我不太清楚这个问题的意思</p>
<p>问：base64 了解吗？</p>
<p>答：哦原来是这个意思，就是三八二十四，即把三个字节的内容用，二十四除以六，即四个字符来表示。</p>
<p>C/C++ 相关：</p>
<p>问：++i 和 i++ 哪个性能更好</p>
<p>答：++i，但是现在编译器都会优化的。</p>
<p>问：大端小端知道吗</p>
<p>答：知道</p>
<p>问：如果把一个结构体强制类型转化为另一个结构体，使用它的成员(在黑板上举了个例子<code>a-&gt;B</code>)，那么能编译成功吗？</p>
<p>答：能</p>
<p>问：我的这个例子，<code>a-&gt;B</code> 它运行起来是什么</p>
<p>答：如果他们两个结构体的第一个成员的字节数是相同的，那么这个其实就是指向的第一个成员，用起来没有什么问题，反之，有问题。</p>
<p>问：堆和栈？</p>
<p>答：略</p>
<p>问：static 的作用</p>
<p>答：静态存储区，内部作用域</p>
<p>问：编译 和 链接 做的事情</p>
<p>答：编译把 .c 编译成二进制文件 .o，如果一个函数在一个地方声明使用了，在链接的时候就要把定义它的 .o 文件链接起来。</p>
<p>问：那么如果有两个地方都定义了，编译时报错，怎么解决？</p>
<p>答：我不知道有什么编译选项可以做到这个，我会做的就是修改其中一个的名字，或者改变作用域。我说用namespace。</p>
<p>交流：面试官说其实刚才说的 static 就行，我说对对对。</p>
<p>问：那还有其他方法吗？</p>
<p>答：不知道，没碰到过</p>
<p>回：没关系，其实很少遇到，正常的</p>
<p>Linux 相关</p>
<p>问：用 shell 登入之后，执行一个程序，但是退出后程序就终止了，有什么办法</p>
<p>答：screen</p>
<p>回：对，还有什么办法呢？nohup 知道吗</p>
<p>答：不知道(后来发现其实我了解过，当时忘了，悔恨)</p>
<p>问：死锁是什么情况</p>
<p>答：举了个两个线程互相lock的例子</p>
<p>问：那怎么解决呢</p>
<p>想了很久，想不出来往什么方面思考，故答：别这么写不就行了</p>
<p>回我：额，对~</p>
<p>项目相关问题：</p>
<p>问：你的线程池的调度方法</p>
<p>答：条件变量，balabala…</p>
<p>问：<code>notify_one()</code> 的底层实现原理是什么</p>
<p>答：不知道</p>
<p>问：你用的是C++11的线程方法，那么操作系统提供了哪些线程通信方法</p>
<p>答：信号量，互斥量(其实我不知道怎么回答，因为C++的线程库已经很全面了，面试官也没继续问)</p>
<p>问：线程池的线程数量也是有问题的，你开了几个，为什么</p>
<p>答：6个，因为数量多的话只能并发，并不能并行，因为CPU个数和核数是有限的。</p>
<p>算法相关：</p>
<p>问：删除一个 <code>vector&lt;int&gt;</code> 里面的偶数</p>
<p>写：直接用 erase 和 lambda 函数(后来发现写错了，回去看了下文档 erase 没有重载可选的谓词参数，其实应该用 C++20 的 erase_if，但是面试官当时应该没发现)</p>
<p>问：其实我刚才只是看一下你对 STL 的掌握程度，自己实现呢？</p>
<p>一开始没想出来，面试官提示了一下：交换，然后我立马说知道怎么做了。</p>
<p>答：把后面的元素复制到前面是偶数的地方，最后一次性删除后面剩余的元素，然后写了一下。</p>
<p>SQL 相关：</p>
<p>问：项目里写的SQL有什么安全问题需要关注的吗</p>
<p>答：存密码的时候md5加密一下</p>
<p>问：其实我问的是SQL注入方面的，你了解吗</p>
<p>答：此处省略SQL注入定义。。。可以查找特殊字符然后删除</p>
<p>问：有时候用户并不想删除呢</p>
<p>答：可以像html一样用转义字符</p>
<p>问：SQL性能优化的方法</p>
<p>答：索引相关，balabala…</p>
<p>问：索引也有弊端</p>
<p>答：插入和删除会变慢</p>
<p>问：索引的数据结构</p>
<p>答：B+树</p>
<h3 id="二面"><a href="#二面" class="headerlink" title="二面"></a>二面</h3><p>STL 相关：</p>
<p>问：STL 平时用哪些</p>
<p>答：比如我这个项目存储用户信息就是用的无序map也就是哈希表</p>
<p>问：为什么不用其他的</p>
<p>答：其他的查找要遍历，这个时间 O(1)</p>
<p>问：还有什么</p>
<p>答：比如我这个线程池的工作队列就是 queue，其实它就是对 deque 的封装</p>
<p>问：为什么不用 deque 呢</p>
<p>答：因为队列只需要尾部插入，头部弹出这两个动作，使用封装的 queue 更加安全。</p>
<p>问：deque 和 vector 内部差别</p>
<p>答：deque 内部有一个 map 维护很多块连续的内存，队头和队尾弹出之后，只会浪费一部分空间，如果插入时一个块满了，那就分配一个新的块。</p>
<p>项目相关：</p>
<p>问：为什么不用信号量而用条件变量呢？</p>
<p>答：信号量不知道唤醒哪一个，条件变量的 <code>notify_one()</code> 的话只会唤醒一个。(瞎说的)</p>
<p>问：服务端客户端通信的时候，你有什么安全措施吗？</p>
<p>答：客户端先用公钥加密对称秘钥，然后服务端解密，之后就用对称秘钥加密消息。我是用的 openssl。</p>
<p>安全相关：</p>
<p>问：你说下你做的些安全方面的内容</p>
<p>答：详细说了自己写的 XSS 蠕虫。。。arp欺骗，dns欺骗。</p>
<p>问：那怎么预防这个欺骗呢</p>
<p>答：只进行一次 ip 和 mac 的绑定</p>
<p>问：你搭建的 **N 的原理是什么</p>
<p>答：应用层 **N，可以绕过长*防火墙，略</p>
<p>回：你当心一点</p>
<p>问：静态路由和（没听清）路由哪个优先级高</p>
<p>答：不知道，没有复习这方面</p>
<p>网络相关：</p>
<p>问：你项目用了balabala…(其实就是问IO复用的一些接口)</p>
<p>答：其实我一开始是用select的，但是之后学了libevent更好，就用libevent重写了。还有poll、epoll之类。</p>
<p>问：那你了解过它们什么区别</p>
<p>答：最差的是select因为每次都要遍历所有文件描述符，然后poll的提升之处就是改成了链表，但是每次调用还是要从用户空间完整拷贝到内核，epoll的话只在创建的时候进行插入，插入到内核的红黑树。而且epoll支持边沿触发，事件发生后从就绪链表直接删除不再进行下一轮检查，省略100字。。。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Mess/">Mess</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Job/">Job</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-QT/Qt issues" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/20/QT/Qt issues/" class="article-date">
      <time datetime="2019-04-20T09:16:08.000Z" itemprop="datePublished">2019-04-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/20/QT/Qt issues/">Qt issues</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Qt-issues"><a href="#Qt-issues" class="headerlink" title="Qt issues"></a>Qt issues</h2><h3 id="symbol-not-found-iconv"><a href="#symbol-not-found-iconv" class="headerlink" title="symbol not found: _iconv"></a>symbol not found: _iconv</h3><p><strong>problem:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dyld: Symbol not found: _iconv</span><br><span class="line">  Referenced from: /usr/lib/libcups.2.dylib</span><br><span class="line">  Expected in: /****/lib/libiconv.2.dylib</span><br><span class="line"> in /usr/lib/libcups.2.dylib</span><br></pre></td></tr></table></figure>
<p><strong>fix:</strong></p>
<ol>
<li>Go to Projects -&gt; Run -&gt; “Run Environment” (show Details)</li>
<li>I would not recommend <strong>Unset</strong>, rather you should <strong>edit</strong> Both: <strong>DYLD_LIBRARY_PATH</strong>and <strong>DYLD_FRAMEWORK_PATH</strong></li>
<li>Add <em>/usr/lib:</em> to the beginning for both paths (colon delimited string)</li>
<li>Build project again - this will fix it for good</li>
</ol>
<p><strong>from:</strong></p>
<p><a href="https://stackoverflow.com/questions/38131011/qt-application-throws-dyld-symbol-not-found-cg-jpeg-resync-to-restart" target="_blank" rel="noopener">https://stackoverflow.com/questions/38131011/qt-application-throws-dyld-symbol-not-found-cg-jpeg-resync-to-restart</a></p>
<p>经本人实践：在 Run 设置下，<strong>取消勾选</strong> “Add build library search path to …” 即可。</p>
<h3 id="QLineEdit响应回车时避免Button同时响应"><a href="#QLineEdit响应回车时避免Button同时响应" class="headerlink" title="QLineEdit响应回车时避免Button同时响应"></a>QLineEdit响应回车时避免Button同时响应</h3><p>在Dialog中的按钮默认有autoDefault属性，外观都会变，而且lineEdit响应回车信号的时候，按钮会同时响应点击事件。</p>
<p>解决办法：</p>
<p>在designer中，找到QPushButton的autoDefault属性，将对勾去掉即可。</p>
<p>或者代码修改: pButton-&gt;setAutoDefault(false);</p>
<h3 id="No-rule-to-make-target-“-“-Stop"><a href="#No-rule-to-make-target-“-“-Stop" class="headerlink" title="No rule to make target “ “. Stop."></a>No rule to make target “ “. Stop.</h3><p>On Qt Creator, go into “Projects Tab”, then you can see “Shadow build”. Uncheck this and compile. The error disappears.</p>
<p>from: <a href="https://stackoverflow.com/questions/28767895/qt-no-rule-to-make-target-controlpanel-ui-needed-by-ui-controlpanel-h" target="_blank" rel="noopener">https://stackoverflow.com/questions/28767895/qt-no-rule-to-make-target-controlpanel-ui-needed-by-ui-controlpanel-h</a></p>
<p>经本人测试，只需要更换 shadow build 路径到根文件夹的同级文件夹。</p>
<h2 id="to-be-continued"><a href="#to-be-continued" class="headerlink" title="to be continued"></a>to be continued</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/QT/">QT</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/QT/">QT</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-QT/qt隐藏标题栏并鼠标拖动" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/19/QT/qt隐藏标题栏并鼠标拖动/" class="article-date">
      <time datetime="2019-04-19T07:56:38.000Z" itemprop="datePublished">2019-04-19</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/19/QT/qt隐藏标题栏并鼠标拖动/">qt隐藏标题栏并鼠标拖动</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="qt隐藏标题栏并鼠标拖动"><a href="#qt隐藏标题栏并鼠标拖动" class="headerlink" title="qt隐藏标题栏并鼠标拖动"></a>qt隐藏标题栏并鼠标拖动</h3><p>设置主题</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;setWindowFlags(Qt::FramelessWindowHint);</span><br></pre></td></tr></table></figure>
<p>重写鼠标拖动事件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> LoginWindow::mousePressEvent(QMouseEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    last = e-&gt;globalPos();</span><br><span class="line">    pressed = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> LoginWindow::mouseMoveEvent(QMouseEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(!pressed)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> dx = e-&gt;globalX() - last.x();</span><br><span class="line">    <span class="keyword">int</span> dy = e-&gt;globalY() - last.y();</span><br><span class="line">    last = e-&gt;globalPos();</span><br><span class="line">    move(x()+dx, y()+dy);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> LoginWindow::mouseReleaseEvent(QMouseEvent *e)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(!pressed)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> dx = e-&gt;globalX() - last.x();</span><br><span class="line">    <span class="keyword">int</span> dy = e-&gt;globalY() - last.y();</span><br><span class="line">    move(x()+dx, y()+dy);</span><br><span class="line">    pressed = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/QT/">QT</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/QT/">QT</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Security/openssl" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/17/Security/openssl/" class="article-date">
      <time datetime="2019-04-16T18:59:55.000Z" itemprop="datePublished">2019-04-17</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/17/Security/openssl/">openssl</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="openssl"><a href="#openssl" class="headerlink" title="openssl"></a>openssl</h2><p>记录一下项目中用到的OpenSSL相关内容。</p>
<h3 id="Cmake"><a href="#Cmake" class="headerlink" title="Cmake"></a>Cmake</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(/opt/local/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">link_directories</span>(/opt/local/lib)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成链接库</span></span><br><span class="line"><span class="keyword">add_library</span> (Md5Link Md5Encrypt.cpp Md5Encrypt.h)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(Md5Link crypto)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试用例</span></span><br><span class="line"><span class="keyword">add_executable</span>(test_md5 Md5Encrypt.cpp Md5Encrypt.h test_md5.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(test_md5 crypto)</span><br></pre></td></tr></table></figure>
<h3 id="Md5"><a href="#Md5" class="headerlink" title="Md5"></a>Md5</h3><p>在 <code>openssl/md5.h</code> 里有一些接口：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化 MD5 Contex, 成功返回1,失败返回0</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MD5_Init</span><span class="params">(MD5_CTX *c)</span></span>;</span><br><span class="line"><span class="comment">// 循环调用此函数,可以将不同的数据加在一起计算MD5,成功返回1,失败返回0</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MD5_Update</span><span class="params">(MD5_CTX *c, <span class="keyword">const</span> <span class="keyword">void</span> *data, <span class="keyword">size_t</span> len)</span></span>;</span><br><span class="line"><span class="comment">// 输出MD5结果数据,成功返回1,失败返回0</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MD5_Final</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *md, MD5_CTX *c)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MD5_Init,MD5_Update,MD5_Final三个函数的组合,直接计算出MD5的值</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> *<span class="title">MD5</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *d, <span class="keyword">size_t</span> n, <span class="keyword">unsigned</span> <span class="keyword">char</span> *md)</span></span>;</span><br></pre></td></tr></table></figure>
<p>因为每4位存储一个十六进制数，所以转换后一个字节的高4位和低4位都是一个数，只有16位。</p>
<p>为了以字符串形式存在数据库，实现了一个转化为32位字符串的函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">Md5Encrypt::Enc32(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *in, <span class="keyword">size_t</span> inLen, <span class="keyword">unsigned</span> <span class="keyword">char</span> *out)</span><br><span class="line">&#123;</span><br><span class="line">    MD5(in, inLen, out);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>)</span><br><span class="line">            out[<span class="number">31</span>-i] = (out[<span class="number">15</span>-i/<span class="number">2</span>] &amp; (<span class="keyword">char</span>)<span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            out[<span class="number">31</span>-i] = out[<span class="number">15</span>-i/<span class="number">2</span>] &amp; (<span class="keyword">char</span>)<span class="number">0x0f</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(out[<span class="number">31</span>-i] &lt; <span class="number">10</span>)</span><br><span class="line">            out[<span class="number">31</span>-i] += <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            out[<span class="number">31</span>-i] += <span class="string">'a'</span><span class="number">-10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Rsa"><a href="#Rsa" class="headerlink" title="Rsa"></a>Rsa</h3><p>虽然公钥私钥加密比较慢，但是在认证阶段还是只能这样来保证安全性。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;openssl/pem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Constant.h"</span>	<span class="comment">//MAX_PASSWORD</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RsaEncrypt</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">MakeKey</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Dec</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *in, <span class="keyword">int</span> inLen, <span class="keyword">char</span> *out, <span class="keyword">int</span> * outLen)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Enc</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *in, <span class="keyword">int</span> inLen, <span class="keyword">char</span> *out, <span class="keyword">int</span> * outLen)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//清除加载到内存中的RSA</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Clear</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//maxCodeByte = g_nBits/8-11</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> g_nBits = (MAX_PASSWORD+<span class="number">11</span>)*<span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">char</span> *g_pPubFile;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">char</span> *g_pPriFile;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> RSA *m_p_pubrsa;</span><br><span class="line">    <span class="keyword">static</span> RSA *m_p_prirsa;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"RsaEncrypt.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *</span><br><span class="line">RsaEncrypt::g_pPubFile = <span class="string">"public.pem"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *</span><br><span class="line">RsaEncrypt::g_pPriFile = <span class="string">"private.pem"</span>;</span><br><span class="line">RSA *</span><br><span class="line">RsaEncrypt::m_p_pubrsa = <span class="literal">nullptr</span>;</span><br><span class="line">RSA *</span><br><span class="line">RsaEncrypt::m_p_prirsa = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">RsaEncrypt::Dec(<span class="keyword">const</span> <span class="keyword">char</span> *in, <span class="keyword">int</span> inLen, <span class="keyword">char</span> *out, <span class="keyword">int</span> * outLen)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_p_prirsa == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        BIO *pBio = BIO_new_file(g_pPriFile,<span class="string">"r"</span>);</span><br><span class="line">        m_p_prirsa = PEM_read_bio_RSAPrivateKey(pBio, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        BIO_free_all(pBio);</span><br><span class="line">    &#125;</span><br><span class="line">    *outLen = RSA_private_decrypt(</span><br><span class="line">            inLen,</span><br><span class="line">            (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(in),</span><br><span class="line">            (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(out),</span><br><span class="line">            m_p_prirsa,</span><br><span class="line">            RSA_PKCS1_PADDING);</span><br><span class="line">    <span class="keyword">if</span>(*outLen &gt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">RsaEncrypt::Enc(<span class="keyword">const</span> <span class="keyword">char</span> *in, <span class="keyword">int</span> inLen, <span class="keyword">char</span> *out, <span class="keyword">int</span> * outLen)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_p_pubrsa == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        BIO *pBio = BIO_new_file(g_pPubFile,<span class="string">"r"</span>);</span><br><span class="line">        m_p_pubrsa = PEM_read_bio_RSAPublicKey(pBio, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        BIO_free_all(pBio);</span><br><span class="line">    &#125;</span><br><span class="line">    *outLen = RSA_public_encrypt(</span><br><span class="line">            (RSA_size(m_p_pubrsa)<span class="number">-11</span>)&gt;inLen?inLen:RSA_size(m_p_pubrsa)<span class="number">-11</span>,</span><br><span class="line">            (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(in),</span><br><span class="line">            (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(out),</span><br><span class="line">            m_p_pubrsa,</span><br><span class="line">            RSA_PKCS1_PADDING);</span><br><span class="line">    <span class="keyword">if</span>(*outLen &gt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">RsaEncrypt::MakeKey()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*if (access(g_pPubFile,0) != 0 || access(g_pPriFile,0) != 0)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">     return 0;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="comment">//生成key,这里如果设置了1024，意味着最多可以编解码1024/8-11=117个字节，</span></span><br><span class="line">    <span class="comment">//RSA_F4为公钥指数，一般情况下使用RSA_F4即可，</span></span><br><span class="line">    <span class="comment">//其它两个参数可以设置为NULL</span></span><br><span class="line">    RSA *pRsa = RSA_generate_key(g_nBits, RSA_F4, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (pRsa == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"rsa_generate_key error"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    BIO *pBio = BIO_new_file(g_pPubFile,<span class="string">"wb"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pBio == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">"BIO_new_file = %s  error"</span>,g_pPubFile);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(PEM_write_bio_RSAPublicKey(pBio,pRsa) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"write public key error"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    BIO_free_all(pBio);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    pBio = BIO_new_file(g_pPriFile,<span class="string">"w"</span>);</span><br><span class="line">    <span class="keyword">if</span> (pBio == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"BIO_new_file %s error "</span>,g_pPriFile);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(PEM_write_bio_RSAPrivateKey(pBio, pRsa, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, <span class="number">0</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"write private key error"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    BIO_free_all(pBio);</span><br><span class="line">    RSA_free(pRsa);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">RsaEncrypt::Clear() &#123;</span><br><span class="line">    <span class="keyword">if</span>(m_p_prirsa)</span><br><span class="line">        RSA_free(m_p_prirsa);</span><br><span class="line">    <span class="keyword">if</span>(m_p_pubrsa)</span><br><span class="line">        RSA_free(m_p_pubrsa);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Security/">Security</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Security/">Security</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2019 Skuaka
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="Site Visitors"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="Page Hits"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 1;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>