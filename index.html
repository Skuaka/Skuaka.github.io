<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Skuaka">


    
    


<meta name="description" content="For you, a thousand times over.">
<meta name="keywords" content="skuaka">
<meta property="og:type" content="website">
<meta property="og:title" content="Skuaka">
<meta property="og:url" content="http://skuaka.cn/index.html">
<meta property="og:site_name" content="Skuaka">
<meta property="og:description" content="For you, a thousand times over.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Skuaka">
<meta name="twitter:description" content="For you, a thousand times over.">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Skuaka" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/avatar.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Skuaka</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Skuaka</a></h1>
        </hgroup>

        
        <p class="header-subtitle">For you, a thousand times over.</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>Menu</li>
                        <li>Tags</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">Home</a></li>
                        
                            <li><a href="/archives/">Archives</a></li>
                        
                            <li><a href="/tags/">Tags</a></li>
                        
                            <li><a href="/about/">about</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:skuaka@icloud.com" title="Email"></a>
                            
                                <a class="fa bilibili" href="https://space.bilibili.com/5006495" title="bilibili"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCIE/">CCIE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDos/">DDos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DTD/">DTD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DoNotStarve/">DoNotStarve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dreamweaver/">Dreamweaver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Macos/">Macos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Makefile/">Makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MetaProgram/">MetaProgram</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mp3/">Mp3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenGL/">OpenGL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Perl/">Perl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/QT/">QT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberrypi/">Raspberrypi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLserver/">SQLserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Socks5/">Socks5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tcp-ip/">Tcp/ip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wifi/">Wifi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wireshark/">Wireshark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML/">XML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/base64/">base64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clion/">clion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc-gdb/">gcc,gdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unp/">unp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/操作系统/">操作系统</a></li></ul>
                    </div>
                </section>
                
                
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Skuaka</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Skuaka</a></h1>
            </hgroup>
            
            <p class="header-subtitle">For you, a thousand times over.</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/archives/">Archives</a></li>
                
                    <li><a href="/tags/">Tags</a></li>
                
                    <li><a href="/about/">about</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:skuaka@icloud.com" title="Email"></a>
                            
                                <a class="fa bilibili" target="_blank" href="https://space.bilibili.com/5006495" title="bilibili"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me">
</nav>
      <div class="body-wrap">
  
    <article id="post-Algorithm/C++栈实现队列" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/14/Algorithm/C++栈实现队列/" class="article-date">
      <time datetime="2019-04-13T16:32:05.000Z" itemprop="datePublished">2019-04-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/14/Algorithm/C++栈实现队列/">C++栈实现队列</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="C-栈实现队列"><a href="#C-栈实现队列" class="headerlink" title="C++栈实现队列"></a>C++栈实现队列</h3><p>内部管理两个栈，栈1只插入数据，栈2只弹出数据。(除非当只有一个元素且在栈1的时候是由栈1直接弹出。)</p>
<p>每次栈2为空时，top操作和pop操作都会致使元素从栈1弹出并存到栈2（缓存）。然后元素从栈2弹出的顺序就和插入栈1的顺序相同，实现了先进先出。</p>
<p>注意：模仿STL库提供的接口，由用户检查插入弹出的合法性。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">myQueue</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">   <span class="function"><span class="keyword">const</span> T&amp; <span class="title">front</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(stack2.empty()) &#123;</span><br><span class="line">         <span class="keyword">while</span> (!stack1.empty()) &#123;</span><br><span class="line">            stack2.push(stack1.top());</span><br><span class="line">            stack1.pop();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> stack2.top();</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">      stack1.push(t);</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(stack2.empty()) &#123;</span><br><span class="line">         <span class="keyword">while</span>(stack1.size() &gt; <span class="number">1</span>)</span><br><span class="line">         &#123;</span><br><span class="line">            stack2.push(stack1.top());</span><br><span class="line">            stack1.pop();</span><br><span class="line">         &#125;</span><br><span class="line">         stack1.pop();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         stack2.pop();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> stack1.empty() &amp;&amp; stack2.empty();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">size_t</span> size()&#123;</span><br><span class="line">      <span class="keyword">return</span> stack1.size() + stack2.size();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;T&gt; stack1;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;T&gt; stack2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="C-队列实现栈"><a href="#C-队列实现栈" class="headerlink" title="C++队列实现栈"></a>C++队列实现栈</h3><p>内部两个列队，每次弹出操作都将元素转移到另一个列队中，剩下的最后一个弹出。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">myStack</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(queue2.empty())</span><br><span class="line">			queue1.push(t);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			queue2.push(t);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(queue2.empty()) &#123;</span><br><span class="line">			<span class="keyword">while</span>(queue1.size() &gt; <span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				queue2.push(queue1.front());</span><br><span class="line">				queue1.pop();</span><br><span class="line">			&#125;</span><br><span class="line">			queue1.pop();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">while</span>(queue2.size() &gt; <span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				queue1.push(queue2.front());</span><br><span class="line">				queue2.pop();</span><br><span class="line">			&#125;</span><br><span class="line">			queue2.pop();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">const</span> T&amp; <span class="title">top</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(queue2.empty()) &#123;</span><br><span class="line">			<span class="keyword">return</span> queue1.back();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> queue2.back();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> queue1.empty() &amp;&amp; queue2.empty();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">size_t</span> size() <span class="keyword">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> queue1.size() + queue2.size();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">queue</span>&lt;T&gt; queue1;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">queue</span>&lt;T&gt; queue2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C_C++/C++模板和元编程/C++编译期快速排序" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/11/C_C++/C++模板和元编程/C++编译期快速排序/" class="article-date">
      <time datetime="2019-04-11T14:53:26.000Z" itemprop="datePublished">2019-04-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/11/C_C++/C++模板和元编程/C++编译期快速排序/">C++编译期快速排序</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>来自：<a href="https://playfulprogramming.blogspot.com/2015/01/compile-time-quicksort-in-idiomatic.html" target="_blank" rel="noopener">https://playfulprogramming.blogspot.com/2015/01/compile-time-quicksort-in-idiomatic.html</a></p>
<p>文章太好，阅读完受益匪浅，完整拷贝防遗失。</p>
<h2 id="Compile-time-quicksort-in-idiomatic-modern-C"><a href="#Compile-time-quicksort-in-idiomatic-modern-C" class="headerlink" title="Compile time quicksort in idiomatic modern C++"></a>Compile time quicksort in idiomatic modern C++</h2><p>A contender for the most useless program ever written just got a much needed overhaul. In 2011 I <a href="http://playfulprogramming.blogspot.se/2011/09/compile-time-quick-sort-using-c.html" target="_blank" rel="noopener">wrote</a> about compile time quick sort as a challenge to myself, and as an exercise in the then newfangled variadic templates. Now, having worked with C++11 for a few years, and lately also C++14, I see that the code I wrote then is unnecessarily clumsy and highly unidiomatic.</p>
<p>In C++14 the data representation is easy. <a href="http://en.cppreference.com/w/cpp/utility/integer_sequence" target="_blank" rel="noopener">std::integer_sequence</a> fits perfectly. It really is the same as I used in 2011, but this time it’s provided by the standard library.</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>In order to show sequences, an output streaming operator is handy:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T ... ts&gt;</span><br><span class="line"><span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os,</span><br><span class="line">                         <span class="keyword">const</span> <span class="built_in">std</span>::integer_sequence&lt;T, ts...&gt;&amp;)</span><br><span class="line">&#123;</span><br><span class="line">  os &lt;&lt; <span class="string">"&#123; "</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> T values[] &#123; ts... &#125;;</span><br><span class="line">  <span class="built_in">std</span>::copy(<span class="built_in">std</span>::begin(values),</span><br><span class="line">            <span class="built_in">std</span>::end(values),</span><br><span class="line">            <span class="built_in">std</span>::ostream_iterator&lt;T&gt;(os, <span class="string">" "</span>));</span><br><span class="line">  <span class="keyword">return</span> os &lt;&lt; <span class="string">"&#125;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that the value of the integer sequence is not used. All information is in the type.  That’s why filling the values in a static array makes sense - the output stream operator function will be instantiated for each different sequence being output by a program.</p>
<h3 id="Concatenating-sequences"><a href="#Concatenating-sequences" class="headerlink" title="Concatenating sequences"></a>Concatenating sequences</h3><p>An important problem to solve is that of concatenating sequences. It will be needed in quick sort itself, since it concatenates the sorted sub sequences.</p>
<p>First an introduction of the concat template, accompanied by an alias for making life easier.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ... T&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">concat</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ... T&gt;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">concat_t</span> = <span class="keyword">typename</span> concat&lt;T...&gt;::type;</span><br></pre></td></tr></table></figure>
<p>The alias concat_t&lt;T…&gt; is a convenience. Instead of having to write using a = typename concat&lt;T…&gt;::type, you just write using a = concat_t&lt;T…&gt;.</p>
<p>In ways I dislike the naming convention (I’d like it reversed,) but it follows that of the C++14 standard library, and that is not unimportant. Regardless, I argue that the latter is not just less typing, but is easier to read too.</p>
<p>Now for the partial specializations.</p>
<p>As so often in template meta programming, the solution is recursive. First concatenating a single integer sequence is the trivial base case.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T ... ts&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">concat</span>&lt;std::integer_sequence&lt;T, ts...&gt; &gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">using</span> type = <span class="built_in">std</span>::integer_sequence&lt;T, ts...&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>In ways this is even unnecessarily complicated. You can say that concatenating one type (any type) is that type itself. That would work, but I choose to make partial specializations for std::integer_sequence&lt;&gt; only, since it makes it slightly easier to catch stupid programming mistakes. It also future proofs concat, should I ever feel a need to concatenate other types.</p>
<p>The general case, concatenating two integer sequences, and some unknown tail is the same as concatenating the combination of the two integer sequences with the tail.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T... s1, T... s2, <span class="keyword">typename</span> ... Tail&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">concat</span>&lt;std::integer_sequence&lt;T, s1...&gt;,</span></span><br><span class="line"><span class="class">              std::integer_sequence&lt;T, s2...&gt;,</span></span><br><span class="line"><span class="class">              Tail...&gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">using</span> type = <span class="keyword">concat_t</span>&lt;<span class="built_in">std</span>::integer_sequence&lt;T, s1..., s2...&gt;, Tail...&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Note how the convenience alias concat_t is useful even in the implementation of concat itself.</p>
<p>Let’s see if this works, using a simple program:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">using</span> s1 = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&gt;;</span><br><span class="line">  <span class="keyword">using</span> s2 = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&gt;;</span><br><span class="line">  <span class="keyword">using</span> s3 = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&gt;;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">concat_t</span>&lt;s1, s2, s3&gt;&#123;&#125; &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that even though the output stream operator for std::integer_sequence&lt;&gt; doesn’t use the value itself, a value is none the less needed, so an instance is created.</p>
<p>The output of running the program is:</p>
<p><code>{ 1 2 3 4 5 6 7 8 9 }</code></p>
<p>so that is good.</p>
<h3 id="Partitioning"><a href="#Partitioning" class="headerlink" title="Partitioning"></a>Partitioning</h3><p>Quick sort works by partitioning the sequence into a sequence of the values less than a selected pivot element, and the rest, and then recursively sort those partitions. So partitioning a sequence into two sequences based on a predicate is important.</p>
<p>Here too, the solution is a recursive. The base case of partitioning an empty sequence is trivial:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, V&gt; <span class="class"><span class="keyword">class</span> <span class="title">pred</span>, <span class="title">typename</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">partition</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, V&gt; <span class="class"><span class="keyword">class</span> <span class="title">pred</span>, <span class="title">typename</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">partition</span>&lt;pred, std::integer_sequence&lt;T&gt;&gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">using</span> incl_type = <span class="built_in">std</span>::integer_sequence&lt;T&gt;;</span><br><span class="line">  <span class="keyword">using</span> excl_type = <span class="built_in">std</span>::integer_sequence&lt;T&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>After all, the number of elements selected by the predicate from the empty sequence are none, and likewise for those rejected by it.</p>
<p>The general case is not much more difficult:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, V&gt; <span class="class"><span class="keyword">class</span> <span class="title">pred</span>, <span class="title">typename</span> <span class="title">T</span>, <span class="title">T</span> <span class="title">t</span>, <span class="title">T</span> ... <span class="title">ts</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">partition</span>&lt;pred, std::integer_sequence&lt;T, t, ts...&gt;&gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">using</span> incl = <span class="built_in">std</span>::integer_sequence&lt;T, t&gt;;</span><br><span class="line">  <span class="keyword">using</span> excl = <span class="built_in">std</span>::integer_sequence&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> tail = partition&lt;pred, <span class="built_in">std</span>::integer_sequence&lt;T, ts...&gt; &gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">bool</span> outcome = pred&lt;T, t&gt;::value;</span><br><span class="line">  <span class="keyword">using</span> incl_type = <span class="keyword">concat_t</span>&lt;<span class="built_in">std</span>::<span class="keyword">conditional_t</span>&lt;outcome, incl, excl&gt;,</span><br><span class="line">                             <span class="keyword">typename</span> tail::incl_type&gt;;</span><br><span class="line">  <span class="keyword">using</span> excl_type = <span class="keyword">concat_t</span>&lt;<span class="built_in">std</span>::<span class="keyword">conditional_t</span>&lt;outcome, excl, incl&gt;,</span><br><span class="line">                             <span class="keyword">typename</span> tail::excl_type&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>As always in C++ template meta programming, using alias names for things is a must to keep the code anywhere near readable.</p>
<p>Above tail is the result of the partitioning of the rest of the values. <a href="http://en.cppreference.com/w/cpp/types/conditional" target="_blank" rel="noopener">std::conditional_t</a> results in either TrueType or FalseType depending on the boolean value of the selector.</p>
<p>If we assume that the outcome of the predicate on t (the first element in the sequence) is true, then incl_type becomes the concatenation of std::integer_sequence&lt;T, t&gt; and incl_type from tail, otherwise it becomes the concatenation of the empty sequence and incl_type from tail.</p>
<p>Since this implementation builds both the included sequence and the excluded sequence in parallel, the convention of a convenience alias partition_t&lt;&gt; is of little use. It would be possible to make a filter template instead, that just provides a sequence of selected elements, but then filtering would have to be done twice, the second time with the inverted predicate, and even though we’re in compile time computation, we care about performance and avoid two-pass implementations if we can, right?</p>
<p>Let’s see how this partitioning works, with another simple program:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T v&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">is_odd</span> :</span> <span class="built_in">std</span>::integral_constant&lt;<span class="keyword">bool</span>, v &amp; <span class="number">1</span>&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">using</span> seq = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&gt;;</span><br><span class="line">  <span class="keyword">using</span> elems = partition&lt;is_odd, seq&gt;;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; elems::incl_type&#123;&#125; &lt;&lt; <span class="string">' '</span> &lt;&lt; elems::excl_type&#123;&#125; &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Lines 1-2 defines the simple predicate that tells if an integral value is odd. Line 7 partitions the provided sequence into those selected by the predicate and those rejected by it.</p>
<p>The result of running the program is:</p>
<p><code>{ 1 3 5 } { 2 4 6 }</code></p>
<p>so again, it looks OK.</p>
<h3 id="Quick-sort"><a href="#Quick-sort" class="headerlink" title="Quick sort"></a>Quick sort</h3><p>Given the availability of concat and partition, quicksort becomes rather simple to implement. First the typical introduction of the template:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> U, U, U&gt; <span class="class"><span class="keyword">class</span> <span class="title">compare</span>, <span class="title">typename</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">quicksort</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> U, U, U&gt; <span class="class"><span class="keyword">class</span> <span class="title">compare</span>, <span class="title">typename</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">using</span> <span class="title">quicksort_t</span> = <span class="title">typename</span> <span class="title">quicksort</span>&lt;compare, T&gt;:</span>:type;</span><br></pre></td></tr></table></figure>
<p>Since quicksort only has one result, the convenience alias quicksort_t becomes handy. compare is a binary predicate accepting two values of a given type.</p>
<p>As so often, the base case is trivial.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> U, U, U&gt; <span class="class"><span class="keyword">class</span> <span class="title">compare</span>, <span class="title">typename</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">quicksort</span>&lt;compare, std::integer_sequence&lt;T&gt;&gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">using</span> type = <span class="built_in">std</span>::integer_sequence&lt;T&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>After all, the result of sorting an empty sequence is always an empty sequence.</p>
<p>The general case, a partial specialization of quicksort with a binary predicate compare and an std::integer_sequence&lt;&gt; of at least one element, is surprisingly simple too:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> U, U, U&gt; <span class="class"><span class="keyword">class</span> <span class="title">compare</span>,</span></span><br><span class="line"><span class="class">          <span class="title">typename</span> <span class="title">T</span>, <span class="title">T</span> <span class="title">t</span>, <span class="title">T</span> ... <span class="title">ts</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">struct</span> <span class="title">quicksort</span>&lt;compare, std::integer_sequence&lt;T, t, ts...&gt;&gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> V, V v&gt;</span><br><span class="line">  <span class="keyword">using</span> pred = compare&lt;V, v, t&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> partitions = partition&lt;pred, <span class="built_in">std</span>::integer_sequence&lt;T, ts...&gt;&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> incl_seq = <span class="keyword">typename</span> partitions::incl_type;</span><br><span class="line">  <span class="keyword">using</span> excl_seq = <span class="keyword">typename</span> partitions::excl_type;</span><br><span class="line">  <span class="keyword">using</span> type = <span class="keyword">concat_t</span>&lt;<span class="keyword">quicksort_t</span>&lt;compare, incl_seq&gt;,</span><br><span class="line">                        <span class="built_in">std</span>::integer_sequence&lt;T, t&gt;,</span><br><span class="line">                        <span class="keyword">quicksort_t</span>&lt;compare, excl_seq&gt; &gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Lines 5-6 is an interesting template alias. It makes a unary predicate from the binary predicate compare and the first element of the sequence, t. So, the first element becomes the pivot element to partition the rest of the elements around, and partition requires a unary predicate as its selection criteria. As an example, if compare is “less than”, and the first element t is 8, then predbecomes “is less than 8”.</p>
<p>Line 8 is where this partitioning is done.</p>
<p>Lines 10-11 are just short hand conveniences to make lines 12-14 readable.</p>
<p>Lines 12-14 are just as from the text book, the result of quick sort is the concatenation of quick sort on the partition of elements included by the predicate, the pivot element, and the result of quick sort on the partition of elements excluded by the predicate.</p>
<p>Another simple program shows the result:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T lh, T rh&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">less</span> :</span> <span class="built_in">std</span>::integral_constant&lt;<span class="keyword">bool</span>, (lh &lt; rh)&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">using</span> seq = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">32</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">101</span>, <span class="number">5</span>&gt;;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">quicksort_t</span>&lt;less, seq&gt;&#123;&#125; &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The output from running this program is unsurprisingly:</p>
<p><code>{ 1 3 4 5 7 8 32 99 101 }</code></p>
<h3 id="A-word-on-performance"><a href="#A-word-on-performance" class="headerlink" title="A word on performance"></a>A word on performance</h3><p>Everyone who has studied algorithms knows that it’s poor practice to partition the elements around the first element for quick sort, since it gives sorting an already sorted sequence O(n²) complexity. For any deterministic element selection, there is a vulnerable family of sequences, so to protect against this, the selection of the pivot element for partitioning should be random. Just two days ago, a solution to this was shown by <a href="http://mattbierner.com/" target="_blank" rel="noopener">Matt Bierner</a> in his blog post <a href="http://blog.mattbierner.com/stupid-template-tricks-compile-time-pseudo-random-number-generator/" target="_blank" rel="noopener">“Compile Time Pseudo-Random Number Generator”</a>.  I leave it as an exercise for someone else to improve on the quick sort implementation.</p>
<h3 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap up"></a>Wrap up</h3><p>The readability of this code is vastly improved over the 2011 original, and its shorter too. Using alias templates does not just save typing, but also removes the need for many transformation templates. Performance is also improved over the 2011 original, which used two pass partitioning using a filter.</p>
<p>The utter uselessness of compile time quicksort, however, is not threatened.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MetaProgram/">MetaProgram</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Algorithm/Hash" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/11/Algorithm/Hash/" class="article-date">
      <time datetime="2019-04-11T09:36:44.000Z" itemprop="datePublished">2019-04-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/11/Algorithm/Hash/">Hash</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Hash知识点整理"><a href="#Hash知识点整理" class="headerlink" title="Hash知识点整理"></a>Hash知识点整理</h2><h3 id="哈希函数"><a href="#哈希函数" class="headerlink" title="哈希函数"></a>哈希函数</h3><p>构造哈希函数的<strong>原则</strong>是：</p>
<ol>
<li>函数本身便于计算；</li>
<li>计算出来的地址分布均匀，目的是尽可能减少冲突。</li>
</ol>
<p>构造哈希函数常用的五种方法：</p>
<ol>
<li><p><strong>数字分析法</strong></p>
<p>如果事先知道关键字集合，并且每个关键字的位数比哈希表的地址码位数多时，可以从关键字中选出分布较均匀的若干位，构成哈希地址。</p>
</li>
<li><p><strong>平方取中法</strong></p>
<p>当无法确定关键字中哪几位分布较均匀时，可以先求出关键字的平方值，然后按需要取平方值的中间几位作为哈希地址。这是因为：平方后中间几位和关键字中每一位都相关，故不同关键字会以较高的概率产生不同的哈希地址。</p>
</li>
<li><p><strong>分段叠加法</strong></p>
<p>按哈希表地址位数将关键字分成位数相等的几部分（最后一部分可以较短），然后将这几部分相加，舍弃最高进位后的结果就是该关键字的哈希地址。</p>
<p>具体方法有<strong>折叠法</strong>与<strong>移位法。</strong>移位法是将分割后的每部分低位对齐相加，折叠法是从一端向另一端沿分割界来回折叠（奇数段为正序，偶数段为倒序），然后将各段相加。</p>
</li>
<li><p><strong>除留余数法</strong></p>
<p>假设哈希表长为<em>m</em>，<em>p</em>为小于等于<em>m</em>的最大素数，则哈希函数为</p>
<p><em>h</em>(<em>k</em>) = <em>k % p</em> 。</p>
<p>素数是为了防止当数列的间隔比较稳定时产生大量冲突。</p>
</li>
<li><p><strong>伪随机数法</strong></p>
<p>采用一个伪随机函数做哈希函数，即<em>h(key)=random(key)</em>。</p>
</li>
</ol>
<hr>
<p>在实际应用中，应根据具体情况，灵活采用不同的方法，并用实际数据测试它的性能，以便做出正确判定。通常应考虑以下五个因素 ：</p>
<ul>
<li><p>计算哈希函数所需时间 （简单）。</p>
</li>
<li><p>关键字的长度。</p>
</li>
<li><p>哈希表大小。</p>
</li>
<li><p>关键字分布情况。</p>
</li>
<li><p>记录查找频率。</p>
</li>
</ul>
<h3 id="处理冲突的方法"><a href="#处理冲突的方法" class="headerlink" title="处理冲突的方法"></a>处理冲突的方法</h3><ol>
<li><p>开放定址法/再散列法</p>
<p>这种方法也称<strong>再散列法，</strong>其基本思想是：当关键字<em>key</em>的哈希地址<em>p</em>出现冲突时，以<em>p</em>为基础，产生另一个哈希地址<em>p1</em>，如果<em>p1</em>仍然冲突，再以<em>p1</em>为基础，产生另一个哈希地址<em>p2</em>, … 直到找出一个不冲突的哈希地址<em>pi</em>。</p>
</li>
<li><p>拉链法/链地址法/哈希桶</p>
<p>将所有哈希地址为<em>i</em>的元素构成一个称为<strong>同义词链</strong>的单链表，并将单链表的头指针存在哈希表的第<em>i</em>个单元中，因而查找、插入和删除主要在同义词链中进行。链地址法适用于经常进行插入和删除的情况。</p>
</li>
<li><p>溢出法</p>
<p>将哈希表分为<strong>基本表</strong>和<strong>溢出表</strong>两部分，凡是和基本表发生冲突的元素，一律填入溢出表。</p>
</li>
</ol>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Algorithm/">Algorithm</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algorithm/">Algorithm</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C_C++/C++Collection/C++bitset" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/11/C_C++/C++Collection/C++bitset/" class="article-date">
      <time datetime="2019-04-10T17:57:21.000Z" itemprop="datePublished">2019-04-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/11/C_C++/C++Collection/C++bitset/">C++bitset</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="C-bitset"><a href="#C-bitset" class="headerlink" title="C++bitset"></a>C++bitset</h2><p><code>bitset</code> represents a fixed-size sequence of <code>N</code> bits. Bitsets can be manipulated by standard logic operators and converted to and from strings and integers.</p>
<h3 id="construct"><a href="#construct" class="headerlink" title="construct"></a>construct</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// empty constructor</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; b1; <span class="comment">// [0,0,0,0,0,0,0,0]</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// unsigned long long constructor</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; b2(<span class="number">42</span>);          <span class="comment">// [0,0,1,0,1,0,1,0]</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; bs(<span class="number">0xfff0</span>);      <span class="comment">// [1,1,1,1,0,0,0,0]</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// string constructor</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> bit_string = <span class="string">"110010"</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; b3(bit_string);       <span class="comment">// [0,0,1,1,0,0,1,0]</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; b4(bit_string, <span class="number">2</span>);    <span class="comment">// [0,0,0,0,0,0,1,0]</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; b5(bit_string, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [0,0,0,0,0,0,0,1]</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// string constructor using custom zero/one digits</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> alpha_bit_string = <span class="string">"aBaaBBaB"</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; b6(alpha_bit_string, <span class="number">0</span>, alpha_bit_string.size(), <span class="string">'a'</span>, <span class="string">'B'</span>);</span><br><span class="line"><span class="comment">// [0,1,0,0,1,1,0,1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// char* constructor using custom digits</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; b7(<span class="string">"XXXXYYYY"</span>, <span class="number">8</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>); <span class="comment">// [0,0,0,0,1,1,1,1]</span></span><br></pre></td></tr></table></figure>
<h3 id="Element-access"><a href="#Element-access" class="headerlink" title="Element access"></a>Element access</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>[pos];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">test</span><span class="params">(pos)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">all</span><span class="params">()</span></span>;	<span class="comment">//all set, C++11</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">any</span><span class="params">()</span></span>;	<span class="comment">//any set</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">none</span><span class="params">()</span></span>;	<span class="comment">//none set</span></span><br><span class="line"></span><br><span class="line">count();	<span class="comment">//return the number of bits set to true</span></span><br><span class="line">size();		<span class="comment">//return the size of bits that the bitset can hold</span></span><br></pre></td></tr></table></figure>
<h3 id="Modifiers"><a href="#Modifiers" class="headerlink" title="Modifiers"></a>Modifiers</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// all return *this</span></span><br><span class="line"><span class="built_in">set</span>();						<span class="comment">//set all to true</span></span><br><span class="line"><span class="built_in">set</span>(pos);					<span class="comment">//set pos to true</span></span><br><span class="line"><span class="built_in">set</span>(pos, <span class="literal">false</span>);	<span class="comment">//set pos to false</span></span><br><span class="line"></span><br><span class="line">reset();					<span class="comment">//set all to false</span></span><br><span class="line">reset(pos);				<span class="comment">//set pos to false</span></span><br><span class="line"></span><br><span class="line">flip();						<span class="comment">//flip是翻转的意思</span></span><br><span class="line">flip(pos);</span><br><span class="line"></span><br><span class="line"><span class="comment">//overloaded: &amp;  |  ^  &lt;&lt;  &gt;&gt;  ==  !=</span></span><br></pre></td></tr></table></figure>
<h3 id="Conversions"><a href="#Conversions" class="headerlink" title="Conversions"></a>Conversions</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">to_string(zero = <span class="string">'0'</span>, one = <span class="string">'1'</span>);	<span class="comment">//转化为01字符串，可以修改0和1的表达字符</span></span><br><span class="line">to_ulong();</span><br><span class="line">to_ullong();		<span class="comment">//C++11</span></span><br></pre></td></tr></table></figure>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C_C++/C++模板和元编程/C++可变参数模板" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/11/C_C++/C++模板和元编程/C++可变参数模板/" class="article-date">
      <time datetime="2019-04-10T17:18:09.000Z" itemprop="datePublished">2019-04-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/11/C_C++/C++模板和元编程/C++可变参数模板/">C++可变参数模板</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="C-可变参数模板"><a href="#C-可变参数模板" class="headerlink" title="C++可变参数模板"></a>C++可变参数模板</h2><p>这个还是看例子最直观。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_list</span><span class="params">(Args... args)</span></span>&#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>其中Args是一个<strong>模板参数包</strong>，args是一个<strong>函数参数包</strong>。</p>
<p><strong><em>args包含的值列表与模板参数包Args包含的类型列表匹配。</em></strong></p>
</li>
<li><p>默认是按值传递参数，可以为可变参数模板指定展开模式，比如const、&amp;。</p>
</li>
<li><p>将省略号放在函数参数包右边即可展开参数包。</p>
</li>
<li><p>参数个数为 <code>sizeof…(Args)</code></p>
</li>
<li><p>使用时需要递归展开</p>
</li>
</ul>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><h4 id="可变参数函数模板"><a href="#可变参数函数模板" class="headerlink" title="可变参数函数模板"></a>可变参数函数模板</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// definition for 0 parameters</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_list</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// definition for 1 parameter</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_list</span><span class="params">(<span class="keyword">const</span> T&amp; value)</span></span>&#123;</span><br><span class="line">  	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; value &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// definition for 2 or more parameters</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_list</span><span class="params">(<span class="keyword">const</span> T&amp; value, <span class="keyword">const</span> Args&amp;... args)</span></span>&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; value &lt;&lt; <span class="string">','</span>;</span><br><span class="line">		show_list(args...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="可变参数类模板"><a href="#可变参数类模板" class="headerlink" title="可变参数类模板"></a>可变参数类模板</h4><p>模板元编程的例子，组合integer_sequence。</p>
<p>为可变参数类模板特例化的时候要依据特例化需要的参数来写模板参数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt; //integer_sequence</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T... ts&gt;</span><br><span class="line"><span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os,</span><br><span class="line">                         <span class="keyword">const</span> <span class="built_in">std</span>::integer_sequence&lt;T, ts...&gt;&amp;)</span><br><span class="line">&#123;</span><br><span class="line">    os &lt;&lt; <span class="string">"&#123; "</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> T values[] &#123; ts... &#125;;</span><br><span class="line">    <span class="built_in">std</span>::copy(<span class="built_in">std</span>::begin(values),</span><br><span class="line">              <span class="built_in">std</span>::end(values),</span><br><span class="line">              <span class="built_in">std</span>::ostream_iterator&lt;T&gt;(os, <span class="string">" "</span>));</span><br><span class="line">    <span class="keyword">return</span> os &lt;&lt; <span class="string">"&#125;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">concat</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T... ts&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">concat</span>&lt;std::integer_sequence&lt;T, ts...&gt; &gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">using</span> type = <span class="built_in">std</span>::integer_sequence&lt;T, ts...&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, T... s1, T... s2, <span class="keyword">typename</span>... Tail&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">concat</span>&lt;</span></span><br><span class="line"><span class="class">        std::integer_sequence&lt;T, s1...&gt;,</span></span><br><span class="line"><span class="class">        std::integer_sequence&lt;T, s2...&gt;,</span></span><br><span class="line"><span class="class">        Tail...&gt;</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">using</span> type =<span class="keyword">typename</span> concat&lt;</span><br><span class="line">            <span class="built_in">std</span>::integer_sequence&lt;T, s1..., s2...&gt;,</span><br><span class="line">            Tail...&gt;::type ;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> s1 = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&gt;;</span><br><span class="line">    <span class="keyword">using</span> s2 = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&gt;;</span><br><span class="line">    <span class="keyword">using</span> s3 = <span class="built_in">std</span>::integer_sequence&lt;<span class="keyword">int</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&gt;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; concat&lt;s1, s2, s3&gt;::type&#123;&#125; &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MetaProgram/">MetaProgram</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C_C++/Mess/C++多线程排序" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/09/C_C++/Mess/C++多线程排序/" class="article-date">
      <time datetime="2019-04-09T07:58:43.000Z" itemprop="datePublished">2019-04-09</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/09/C_C++/Mess/C++多线程排序/">C++多线程多路归并排序函数</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="C-多线程多路归并排序函数"><a href="#C-多线程多路归并排序函数" class="headerlink" title="C++多线程多路归并排序函数"></a>C++多线程多路归并排序函数</h2><h3 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h3><h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><ul>
<li>各个线程对分配给它的数据分块进行快速排序(<code>std::sort</code>)。</li>
<li>主线程排序完分配给自己的数据分块后，需要等待(<code>std::future</code>,<code>std::promise</code>)各个线程完成。</li>
<li>主线程多路归并排序(需要自己实现，标准库只有二路归并)。</li>
</ul>
<h4 id="实现注意"><a href="#实现注意" class="headerlink" title="实现注意"></a>实现注意</h4><ul>
<li>本实现大量使用C++11特性。</li>
<li>c语言的qsort内部用到了静态变量，所以不是线程安全的。可以通过在主线程使用一次qsort解决。具体自行搜索或看<a href="https://blog.csdn.net/itegel84/article/details/5871491" target="_blank" rel="noopener">这篇</a>。而这里使用std::sort则没有这个问题。</li>
</ul>
<h4 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h4><ul>
<li>只支持数值类型，读者可自行扩展。</li>
<li>需要支持随机存储</li>
</ul>
<h4 id="数据分块大小"><a href="#数据分块大小" class="headerlink" title="数据分块大小"></a>数据分块大小</h4><p>设数据长度(data_len)为 D，新线程数量(thread_num)为 T，一个分块大小(chunk_size)为 C，最后一个分块的大小(last_chunk_size)为 LC。</p>
<p>直观地，如果工作线程数量可以整除数据长度，那么商就是块大小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LC = C = D/(T+1)</span><br></pre></td></tr></table></figure>
<p>如果不能整除的时候：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C = D/(T+1)+1</span><br><span class="line">LC ∈ (C-(T+1), C)</span><br></pre></td></tr></table></figure>
<p>因为 T 非常小，所以最后一块的大小差别不大，<strong>本实现就由主线程来处理最后一块</strong>。</p>
<h4 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h4><ul>
<li>指向数据首地址的指针</li>
<li>数据长度</li>
<li>指定需要创建的新线程数量</li>
</ul>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// multi_threaded_sort.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MULTI_THREADED_SORT_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MULTI_THREADED_SORT_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> IntegerType&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">multi_threaded_sort</span><span class="params">(IntegerType* in_data, <span class="keyword">size_t</span> data_len, <span class="keyword">size_t</span> thread_num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// compile time type check</span></span><br><span class="line">    <span class="keyword">static_assert</span>(<span class="built_in">std</span>::is_integral&lt;IntegerType&gt;::value,</span><br><span class="line">                  <span class="string">"Data type must be integer"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// under such conditions, multi-thread makes no sense</span></span><br><span class="line">    <span class="comment">// call std::sort directly</span></span><br><span class="line">    <span class="keyword">if</span>(data_len &lt;= <span class="number">1</span> || thread_num == <span class="number">0</span></span><br><span class="line">       || data_len &lt; (thread_num+<span class="number">1</span>)*(thread_num+<span class="number">1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::sort(in_data, in_data+data_len);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* one thread sort one chunk</span></span><br><span class="line"><span class="comment">     * main thread sort the last chunk */</span></span><br><span class="line">    <span class="keyword">size_t</span> chunk_size = data_len/(thread_num+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(data_len%(thread_num+<span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">        ++chunk_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for threads synchronize</span></span><br><span class="line">    <span class="keyword">auto</span> sort_promise = <span class="keyword">new</span> <span class="built_in">std</span>::promise&lt;<span class="keyword">void</span>&gt;[thread_num];</span><br><span class="line">    <span class="keyword">auto</span> sort_future = <span class="keyword">new</span> <span class="built_in">std</span>::future&lt;<span class="keyword">void</span>&gt;[thread_num];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;thread_num; ++i)</span><br><span class="line">        sort_future[i] = sort_promise[i].get_future();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create threads</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>; i&lt;thread_num; ++i)&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="function">thread <span class="title">th</span><span class="params">([=]&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="built_in">std</span>::sort(in_data + i*chunk_size, in_data + (i+<span class="number">1</span>)*chunk_size);</span></span></span><br><span class="line"><span class="function"><span class="params">            sort_promise[i].set_value();</span></span></span><br><span class="line"><span class="function"><span class="params">        &#125;)</span></span>;</span><br><span class="line">        th.detach();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sort the last chunk</span></span><br><span class="line">    <span class="built_in">std</span>::sort(in_data + chunk_size*thread_num, in_data + data_len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// before wait and block, do things not based on data</span></span><br><span class="line">    <span class="keyword">auto</span> out_data = <span class="keyword">new</span> IntegerType[data_len];</span><br><span class="line">    <span class="keyword">auto</span> index = <span class="keyword">new</span> <span class="keyword">size_t</span>[thread_num + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;thread_num + <span class="number">1</span>; ++i)</span><br><span class="line">        index[i] = i * chunk_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// wait for all threads</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>; i&lt;thread_num; ++i)</span><br><span class="line">        sort_future[i].wait();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[] sort_future;</span><br><span class="line">    <span class="keyword">delete</span>[] sort_promise;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// do merge sort</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; data_len; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        IntegerType min_index;</span><br><span class="line">        IntegerType min_num = <span class="built_in">std</span>::numeric_limits&lt;IntegerType&gt;::max();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// traverse every chunk and find the minimum</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">0</span>; j&lt;thread_num; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>((index[j] &lt; (j+<span class="number">1</span>)*chunk_size)</span><br><span class="line">               &amp;&amp; (in_data[index[j]] &lt; min_num))</span><br><span class="line">            &#123;</span><br><span class="line">                min_index = j;</span><br><span class="line">                min_num = in_data[index[j]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(index[thread_num] &lt; data_len</span><br><span class="line">           &amp;&amp; (in_data[index[thread_num]] &lt; min_num))</span><br><span class="line">        &#123;</span><br><span class="line">            min_index = thread_num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        out_data[i] = in_data[index[min_index]];</span><br><span class="line">        index[min_index]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::copy(out_data, out_data + data_len, in_data);</span><br><span class="line">    <span class="keyword">delete</span>[] out_data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//MULTI_THREADED_SORT_H</span></span></span><br></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"multi_threaded_sort.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;random&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"this example check the correctness:"</span>;</span><br><span class="line">        <span class="keyword">short</span> data[] = &#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">93</span>, <span class="number">43</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">-3</span>, <span class="number">43</span>&#125;;</span><br><span class="line">        <span class="keyword">size_t</span> N = <span class="keyword">sizeof</span>(data) / <span class="keyword">sizeof</span>(<span class="keyword">short</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\ninput "</span> &lt;&lt; N &lt;&lt; <span class="string">" data: "</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) <span class="built_in">cout</span> &lt;&lt; data[i] &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">        multi_threaded_sort(data, N, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\n\tsort with 2 threads: "</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) <span class="built_in">cout</span> &lt;&lt; data[i] &lt;&lt; <span class="string">' '</span>;</span><br><span class="line"></span><br><span class="line">        random_shuffle(data, data + N);<span class="comment">// before c++17</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\nafter shuffle: "</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) <span class="built_in">cout</span> &lt;&lt; data[i] &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">        multi_threaded_sort(data, N, <span class="number">3</span>);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\n\tsort with 3 threads: "</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i) <span class="built_in">cout</span> &lt;&lt; data[i] &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// -----------------------------------------------------</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">size_t</span> N = <span class="number">654321</span>;   <span class="comment">// numbers to generate</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">size_t</span> T = <span class="number">6</span>;         <span class="comment">// threads to test</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\n\nthis example check the efficiency:\n"</span></span><br><span class="line">             &lt;&lt; <span class="string">"randomly generate "</span> &lt;&lt; N</span><br><span class="line">             &lt;&lt; <span class="string">" natural number and sort them...\n"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">short</span> random_data[T][N];</span><br><span class="line">        random_device rd;</span><br><span class="line">        default_random_engine rng&#123;rd()&#125;;</span><br><span class="line">        <span class="built_in">std</span>::uniform_int_distribution&lt;<span class="keyword">short</span>&gt; dis;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">            random_data[<span class="number">0</span>][i] = dis(rng);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">1</span>; i &lt; T; ++i)</span><br><span class="line">            copy(random_data[<span class="number">0</span>], random_data[<span class="number">0</span>] + N, random_data[i]);</span><br><span class="line"></span><br><span class="line">        chrono::time_point&lt;chrono::high_resolution_clock&gt; <span class="keyword">start_t</span>[T], <span class="keyword">end_t</span>[T];</span><br><span class="line">        chrono::duration&lt;<span class="keyword">double</span>, <span class="built_in">std</span>::milli&gt; elapsed[T];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; T; ++i) &#123;</span><br><span class="line">            <span class="keyword">start_t</span>[i] = chrono::high_resolution_clock::now();</span><br><span class="line">            <span class="keyword">if</span> (i)</span><br><span class="line">                multi_threaded_sort(random_data[<span class="number">1</span>], N, i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                sort(random_data[<span class="number">0</span>], random_data[<span class="number">0</span>] + N);</span><br><span class="line">            <span class="keyword">end_t</span>[i] = chrono::high_resolution_clock::now();</span><br><span class="line">            elapsed[i] = <span class="keyword">end_t</span>[i] - <span class="keyword">start_t</span>[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Use std::sort() cost: "</span> &lt;&lt; elapsed[<span class="number">0</span>].count() &lt;&lt; <span class="string">" ms\n"</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">1</span>; i &lt; T; ++i)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"Add "</span> &lt;&lt; i &lt;&lt; <span class="string">" threads   cost: "</span> &lt;&lt; elapsed[i].count() &lt;&lt; <span class="string">" ms\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">this example check the correctness:</span><br><span class="line">input 10 data: 2 5 5 3 93 43 3 0 -3 43 </span><br><span class="line">	sort with 2 threads: -3 0 2 3 3 5 5 43 43 93 </span><br><span class="line">after shuffle: 5 -3 3 5 43 43 3 0 2 93 </span><br><span class="line">	sort with 3 threads: -3 0 2 3 3 5 5 43 43 93 </span><br><span class="line"></span><br><span class="line">this example check the efficiency:</span><br><span class="line">randomly generate 654321 natural number and sort them...</span><br><span class="line">Use std::sort() cost: 36.1254 ms</span><br><span class="line">Add 1 threads   cost: 25.5484 ms</span><br><span class="line">Add 2 threads   cost: 9.9246 ms</span><br><span class="line">Add 3 threads   cost: 10.2634 ms</span><br><span class="line">Add 4 threads   cost: 11.2967 ms</span><br><span class="line">Add 5 threads   cost: 14.7214 ms</span><br></pre></td></tr></table></figure>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><ul>
<li><p>因为线程本身创建和销毁需要时间，所以在数据量较少的情况下使用多线程肯定是不值得的，反而会变慢。</p>
</li>
<li><p>因为CPU核数是有限的，所以可以并发执行线程数肯定不会很高，所以创建过多线程也是没有用的，线程数达到某个数量(一般很小)后排序速度随线程数量增加而缓慢下降。</p>
</li>
</ul>
<p>对于上面两点，读者可以修改测试代码的 N 和 T 自己进行测试。</p>
<p>笔者水平有限，如有错误，还望指出。</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C_C++/Mess/new和malloc区别" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/08/C_C++/Mess/new和malloc区别/" class="article-date">
      <time datetime="2019-04-08T11:28:56.000Z" itemprop="datePublished">2019-04-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/08/C_C++/Mess/new和malloc区别/">new和malloc区别</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>来自：<a href="http://www.cnblogs.com/QG-whz/p/5140930.html" target="_blank" rel="noopener">http://www.cnblogs.com/QG-whz/p/5140930.html</a></p>
<h3 id="new和malloc区别"><a href="#new和malloc区别" class="headerlink" title="new和malloc区别"></a>new和malloc区别</h3><table>
<thead>
<tr>
<th style="text-align:center">特征</th>
<th style="text-align:center">new/delete</th>
<th style="text-align:center">malloc/free</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">分配内存的位置</td>
<td style="text-align:center">自由存储区</td>
<td style="text-align:center">堆</td>
</tr>
<tr>
<td style="text-align:center">内存分配成功的返回值</td>
<td style="text-align:center">完整类型指针</td>
<td style="text-align:center">void*</td>
</tr>
<tr>
<td style="text-align:center">内存分配失败的返回值</td>
<td style="text-align:center">默认抛出异常</td>
<td style="text-align:center">返回NULL</td>
</tr>
<tr>
<td style="text-align:center">分配内存的大小</td>
<td style="text-align:center">由编译器根据类型计算得出</td>
<td style="text-align:center">必须显式指定字节数</td>
</tr>
<tr>
<td style="text-align:center">处理数组</td>
<td style="text-align:center">有处理数组的new版本new[]</td>
<td style="text-align:center">需要用户计算数组的大小后进行内存分配</td>
</tr>
<tr>
<td style="text-align:center">已分配内存的扩充</td>
<td style="text-align:center">无法直观地处理</td>
<td style="text-align:center">使用realloc简单完成</td>
</tr>
<tr>
<td style="text-align:center">函数重载</td>
<td style="text-align:center">允许</td>
<td style="text-align:center">不允许</td>
</tr>
<tr>
<td style="text-align:center">构造函数与析构函数</td>
<td style="text-align:center">调用</td>
<td style="text-align:center">不调用</td>
</tr>
</tbody>
</table>
<h4 id="自由存储区和堆"><a href="#自由存储区和堆" class="headerlink" title="自由存储区和堆"></a>自由存储区和堆</h4><p>从技术上来说，堆（heap）是C语言和操作系统的术语。堆是操作系统所维护的一块特殊内存。而自由存储是C++中通过new和delete动态分配和释放对象的抽象概念，通过new来申请的内存区域可称为自由存储区。</p>
<p>基本上，所有的C++编译器默认使用堆来实现自由存储，也即是缺省的全局运算符new和delete也许会按照malloc和free的方式来被实现，这时藉由new运算符分配的对象，说它在堆上也对，说它在自由存储区上也正确。但程序员也可以<strong>通过重载操作符</strong>，改用其他内存来实现自由存储，例如全局变量做的对象池，这时自由存储区就区别于堆了。</p>
<h3 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-C_C++/Concept_gcc/C++命名规范" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/07/C_C++/Concept_gcc/C++命名规范/" class="article-date">
      <time datetime="2019-04-07T08:37:00.000Z" itemprop="datePublished">2019-04-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/07/C_C++/Concept_gcc/C++命名规范/">C++命名规范</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="C-命名规范"><a href="#C-命名规范" class="headerlink" title="C++命名规范"></a>C++命名规范</h2><p>源自：<a href="https://www.cnblogs.com/heyonggang/p/3362873.html" target="_blank" rel="noopener">https://www.cnblogs.com/heyonggang/p/3362873.html</a></p>
<h3 id="整体原则"><a href="#整体原则" class="headerlink" title="整体原则"></a>整体原则</h3><p>在引入细节之前，先说明一下命名规范的整体原则：</p>
<table>
<thead>
<tr>
<th>同一性</th>
<th>在编写一个子模块或派生类的时候，要遵循其基类或整体模块的命名风格，保持命名风格在整个模块中的同一性。</th>
</tr>
</thead>
<tbody>
<tr>
<td>标识符组成</td>
<td>标识符采用英文单词或其组合，应当直观且可以拼读，可望文知意，用词应当准确。</td>
</tr>
<tr>
<td>最小化长度 &amp;&amp; 最大化信息量原则</td>
<td>在保持一个标识符意思明确的同时，应当尽量缩短其长度。</td>
</tr>
<tr>
<td>避免过于相似</td>
<td>不要出现仅靠大小写区分的相似的标识符，例如“i”与“I”，“function”与“Function”等等。</td>
</tr>
<tr>
<td>避免在不同级别的作用域中重名</td>
<td>程序中不要出现名字完全相同的局部变量和全局变量，尽管两者的作用域不同而不会发生语法错误，但容易使人误解。</td>
</tr>
<tr>
<td>正确命名具有互斥意义的标识符</td>
<td>用正确的反义词组命名具有互斥意义的标识符，如：”nMinValue”和”nMaxValue”，”GetName()” 和 “SetName()” ….</td>
</tr>
<tr>
<td>避免名字中出现数字编号</td>
<td>尽量避免名字中出现数字编号，如Value1,Value2等，除非逻辑上的确需要编号。这是为了防止程序员偷懒，不肯为命名动脑筋而导致产生无意义的名字（因为用数字编号最省事）。</td>
</tr>
</tbody>
</table>
<h3 id="类-结构"><a href="#类-结构" class="headerlink" title="类/结构"></a>类/结构</h3><p>除了异常类等个别情况（不希望用户把该类看作一个普通的、正常的类之情况）外，C++类/结构<br>的命名应该遵循以下准则：</p>
<table>
<thead>
<tr>
<th>C++类/结构的命名</th>
<th>类的名称都要以大写字母“C”开头，后跟一个或多个单词。为便于界定，每个单词的首字母要大写。</th>
</tr>
</thead>
<tbody>
<tr>
<td>推荐的组成形式</td>
<td>类的命名推荐用”名词”或”形容词＋名词”的形式，例如：”CAnalyzer”, “CFastVector” ….</td>
</tr>
<tr>
<td>传统C结构体的命名</td>
<td>传统C结构体的名称全部由大写字母组成，单词间使用下划线界定，例如：”SERVICE_STATUS”, “DRIVER_INFO” ….</td>
</tr>
</tbody>
</table>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><table>
<thead>
<tr>
<th>函数的命名</th>
<th>函数的名称由一个或多个单词组成。为便于界定，每个单词的首字母要大写。</th>
</tr>
</thead>
<tbody>
<tr>
<td>推荐的组成形式</td>
<td>函数名应当使用”动词”或者”动词＋名词”（动宾词组）的形式。例如：”GetName()”, “SetValue()”, “Erase()”, “Reserve()” ….</td>
</tr>
<tr>
<td>保护成员函数</td>
<td>保护成员函数的开头应当加上一个下划线“_”以示区别，例如：”_SetState()” ….</td>
</tr>
<tr>
<td>私有成员函数</td>
<td>类似地，私有成员函数的开头应当加上两个下划线“<strong>”，例如：”</strong>DestroyImp()” ….</td>
</tr>
<tr>
<td>虚函数</td>
<td>虚函数习惯以“Do”开头，如：”DoRefresh()”, “_DoEncryption()” ….</td>
</tr>
<tr>
<td>回调和事件处理函数</td>
<td>回调和事件处理函数习惯以单词“On”开头。例如：”_OnTimer()”, “OnExit()” ….</td>
</tr>
</tbody>
</table>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量名由<strong><em>作用域前缀＋类型前缀＋一个或多个单词</em></strong>组成。为便于界定，每个单词的首字母要大写。</p>
<p>对于某些用途简单明了的局部变量，也可以使用简化的方式，如：i, j, k, x, y, z ….</p>
<p><strong>作用域前缀</strong></p>
<table>
<thead>
<tr>
<th><strong>前缀</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><em>无</em></td>
<td>局部变量</td>
</tr>
<tr>
<td>m_</td>
<td>类的成员变量（member）</td>
</tr>
<tr>
<td>sm_</td>
<td>类的静态成员变量（static member）</td>
</tr>
<tr>
<td>s_</td>
<td>静态变量（static）</td>
</tr>
<tr>
<td>g_</td>
<td>外部全局变量（global）</td>
</tr>
<tr>
<td>sg_</td>
<td>静态全局变量（static global）</td>
</tr>
<tr>
<td>gg_</td>
<td>进程间共享的共享数据段全局变量（global global）</td>
</tr>
</tbody>
</table>
<p><strong>类型前缀</strong></p>
<p>类型前缀可以组合使用，例如”gc”表示字符数组，”ppn”表示指向整型的指针的指针等等。</p>
<table>
<thead>
<tr>
<th>前缀</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>整型和位域变量（number）</td>
</tr>
<tr>
<td>e</td>
<td>枚举型变量（enumeration）</td>
</tr>
<tr>
<td>c</td>
<td>字符型变量（char）</td>
</tr>
<tr>
<td>b</td>
<td>布尔型变量（bool）</td>
</tr>
<tr>
<td>f</td>
<td>浮点型变量（float）</td>
</tr>
<tr>
<td>p</td>
<td>指针型变量和迭代子（pointer）</td>
</tr>
<tr>
<td>pfn</td>
<td>特别针对指向函数的指针变量和函数对象指针（pointer of function）</td>
</tr>
<tr>
<td>g</td>
<td>数组（grid）</td>
</tr>
<tr>
<td>i</td>
<td>类的实例（instance）<br>对于经常用到的类，也可以定义一些专门的前缀，<br>如：std::string类的前缀可以定义为”st”，std::vector类的前缀可以定义为”v”。</td>
</tr>
</tbody>
</table>
<p><strong>推荐的组成形式</strong></p>
<p>变量的名字应当使用”名词”或者”形容词＋名词”。例如：”nCode”, “m_nState”，”nMaxWidth” ….</p>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>常量名由类型前缀＋全大写字母组成，单词间通过下划线来界定，如：cDELIMITER, nMAX_BUFFER ….</p>
<p>类型前缀的定义与变量命名规则中的相同。</p>
<h3 id="枚举-联合-typedef"><a href="#枚举-联合-typedef" class="headerlink" title="枚举/联合/typedef"></a>枚举/联合/typedef</h3><p>枚举、联合、typedef语句生成的类型名由全大写字母组成，单词间通过下划线来界定，如：FAR_PROC, ERROR_TYPE ….</p>
<h3 id="宏-枚举"><a href="#宏-枚举" class="headerlink" title="宏/枚举"></a>宏/枚举</h3><p>宏和枚举值由全大写字母组成，单词间通过下划线来界定，如：ERROR_UNKNOWN, OP_STOP ….</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/C-C/">C/C++</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-C/">C/C++</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Network/Http/https与ssl" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/06/Network/Http/https与ssl/" class="article-date">
      <time datetime="2019-04-06T12:39:23.000Z" itemprop="datePublished">2019-04-06</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/06/Network/Http/https与ssl/">https 与 ssl</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>Hypertext Transfer Protocol Secure，缩写：HTTPS，常称为HTTP over TLS，HTTP over SSL，HTTP Secure。</p>
<p>HTTP端口：80，HTTPS端口：443。</p>
<p>在计算机网络上，HTTPS经由超文本传输协议（HTTP）进行通信，但利用SSL/TLS来加密数据包。</p>
<p><strong>HTTP的特点</strong></p>
<ul>
<li><p>无状态：协议对客户端没有状态存储，对事物处理没有“记忆”能力，比如访问一个网站需要反复进行登录操作</p>
</li>
<li><p>无连接：HTTP/1.1之前，由于无状态特点，每次请求需要通过TCP三次握手四次挥手，和服务器重新建立连接。比如某个客户机在短时间多次请求同一个资源，服务器并不能区别是否已经响应过用户的请求，所以每次需要重新响应请求，需要耗费不必要的时间和流量。</p>
</li>
<li><p>基于请求和响应：基本的特性，由客户端发起请求，服务端响应</p>
</li>
<li><p>简单快速、灵活</p>
</li>
<li><p>通信使用明文、请求和响应不会对通信方进行确认、无法保护数据的完整性</p>
</li>
</ul>
<p><strong>HTTPS的特点</strong></p>
<ol>
<li>内容加密：采用混合加密技术，中间者无法直接查看明文内容</li>
<li>验证身份：通过证书认证客户端访问的是自己的服务器</li>
<li>保护数据完整性：防止传输的内容被中间人冒充或者篡改</li>
</ol>
<h3 id="握手"><a href="#握手" class="headerlink" title="握手"></a>握手</h3><p>HTTPS在传输数据之前需要客户端（浏览器）与服务端（网站）之间进行一次握手，在握手过程中将确立双方加密传输数据的密码信息。TLS/SSL协议不仅仅是一套加密传输的协议，更是一件经过艺术家精心设计的艺术品，TLS/SSL中使用了<strong>非对称加密</strong>，<strong>对称加密</strong>，<strong>HASH算法</strong>。握手过程的具体描述如下：</p>
<ul>
<li>1）浏览器将自己支持的一套加密规则发送给网站。 </li>
<li>2）网站从中选出一组加密算法与HASH算法，并将自己的身份信息以证书的形式发回给浏览器。证书里面包含了网站地址，加密公钥，以及证书的颁发机构等信息。  </li>
<li>3）浏览器获得网站证书之后浏览器要做以下工作：  a) 验证证书的合法性（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。  b) 如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码，并用证书中提供的公钥加密。  c) 使用约定好的HASH算法计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。 </li>
<li> 4）网站接收浏览器发来的数据之后要做以下的操作：  a) 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致。  b) 使用密码加密一段握手消息，发送给浏览器。 </li>
<li> 5）浏览器解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。 </li>
</ul>
<p>这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。另外，HTTPS一般使用的加密与HASH算法如下：</p>
<ul>
<li>非对称加密算法：RSA，DSA/DSS</li>
<li>对称加密算法：AES，RC4，3DES</li>
<li>HASH算法：MD5，SHA1，SHA256</li>
</ul>
<h4 id="通信时序图"><a href="#通信时序图" class="headerlink" title="通信时序图"></a>通信时序图</h4><p><img src="http://www.runoob.com/wp-content/uploads/2017/05/201208201734403507.png" alt="201208201734403507"></p>
<h2 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h2><p>secure socket layer (安全套接字层)</p>
<p>SSL证书和我们日常用的身份证类似，是一个支持HTTPS网站的身份证明，SSL证书里面包含了网站的域名，证书有效期，证书的颁发机构以及用于加密传输密码的公钥等信息，由于公钥加密的密码只能被在申请证书时生成的私钥解密，因此浏览器在生成密码之前需要先核对当前访问的域名与证书上绑定的域名是否一致，同时还要对证书的颁发机构进行验证，如果验证失败浏览器会给出证书错误的提示。</p>
<h3 id="证书的类型"><a href="#证书的类型" class="headerlink" title="证书的类型"></a>证书的类型</h3><p>实际上，我们使用的证书分很多种类型，SSL证书只是其中的一种。SSL证书负责传输公钥，是一种PKI（Public Key Infrastructure，公钥基础结构）证书。 我们常见的证书根据用途不同大致有以下几种：</p>
<ul>
<li> 1、SSL证书，用于加密HTTP协议，也就是HTTPS。</li>
<li> 2、代码签名证书，用于签名二进制文件，比如Windows内核驱动，Firefox插件，Java代码签名等等。</li>
<li> 3、客户端证书，用于加密邮件。</li>
<li> 4、双因素证书，网银专业版使用的USB Key里面用的就是这种类型的证书。</li>
</ul>
<p> 这些证书都是由受认证的证书颁发机构——我们称之为<strong>CA（Certificate Authority）</strong>机构来颁发，针对企业与个人的不同，可申请的证书的类型也不同，价格也不同。CA机构颁发的证书都是受信任的证书，对于SSL证书来说，如果访问的网站与证书绑定的网站一致就可以通过浏览器的验证而不会提示错误。</p>
<h3 id="SSL证书申请与规则"><a href="#SSL证书申请与规则" class="headerlink" title="SSL证书申请与规则"></a>SSL证书申请与规则</h3><p>SSL证书可以向CA机构通过付费的方式申请，也可以自己制作。 CA机构颁发的证书价格非常昂贵，而且有效期一般只有一年到三年不等（年数不同，价格也不同），过期之后还要再次交钱申请，因此一般只有企业才会申请证书。但是随着个人网站的增多，目前也有针对个人的SSL证书服务，价格相对便宜一些，国内的话400多块钱就能申请到一个，国外更是有免费的SSL证书可以申请。 在申请SSL证书时需要向CA机构提供网站域名，营业执照，以及申请人的身份信息等。网站的域名非常重要，申请人必须证明自己对域名有所有权，如果支持Hotmail.com，Gmail.com的SSL证书都可以随便申请，黑客们就不用做假证书欺骗了。</p>
<p>此外，一个证书一般只绑定一个域名，如果CA机构心情好的话，会免费再绑一个，比如你要申请域名时绑定的域名是 <a href="http://www.runoob.com" target="_blank" rel="noopener">www.runoob.com</a> ，那么只有在浏览器地址是 <a href="https://www.runoob.com" target="_blank" rel="noopener">https://www.runoob.com</a>  的时候，这个证书才是受信任的，如果地址是 <a href="https://tt.runoob.com" target="_blank" rel="noopener">https://tt.runoob.com</a> 或者 <a href="https://login.runoob.com" target="_blank" rel="noopener">https://login.runoob.com</a> ，那么这个证书由于访问的域名与证书绑定的域名不同，仍然会被浏览器显示为不受信任的。</p>
<p>CA机构也提供申请通配符域名（例如，*.runoob.com），通配符域名相当于绑定了主域名下的所有域名，因此使用起来非常方便，但是价格也超级昂贵，一个通配符域名一年大概得5000块钱，只有企业才可以申请。 </p>
<hr>
<p>以上说的是向CA机构申请证书的情况，如果个人网站只为加密传输也可以自己制作SSL证书，自己制作的证书不会受到浏览器的信任，在访问的时候由于证书验证失败而给出警告。</p>
<h3 id="SSL证书欺骗"><a href="#SSL证书欺骗" class="headerlink" title="SSL证书欺骗"></a>SSL证书欺骗</h3><p>对HTTPS最常见的攻击手段就是SSL证书欺骗或者叫SSL劫持，是一种典型的中间人攻击。不过SSL劫持并非只是用于攻击目的，在一些特殊情况下利用SSL劫持我们可以更顺畅的访问网络，我会在后文提到。</p>
<p>以攻击为目的的SSL劫持如果不注意浏览器安全提示的话，很容易就中招。当网络中有中间人发起SSL劫持攻击时，攻击者需要伪造一个SSL证书发给浏览器，这个时候由于伪造的SSL证书不受信任，浏览器会给出提示。</p>
<p>这里有一个误区，当SSL证书不受信任的时候，并不一定就是有SSL劫持发生，有种例外情况是：一些个人网站买不起合法的SSL证书，因此会自己制作一个SSL证书来加密传输的数据。如果你经常访问某个个人网站，而且你知道这个网站是干什么的，那么这种情况可以不用担心。但是如果你访问的是网银，在线支付，或者是hotmail.com，gmail.com等，这类公司性质的网站一定会申请合法的SSL证书（12306.cn除外），一旦SSL证书不受信任，应该果断的终止访问，这个时候网络中一定会存在异常行为，对于一些小区宽带的用户一定要注意这点。</p>
<p>所以作为个人用户，你一定要知道你访问的是什么网站，如果你只是一个没有多少计算机只是的普通网民，我相信你不会经常上那些自己制作SSL证书的个人网站（12306.cn除外），因此如果你没有办法判断网络是不是有异常，只要是证书有问题的，干脆就别再访问了。</p>
<blockquote>
<p>小提示：对于12306.cn，一定要按照网站说的那样，”为保障您顺畅购票，请下载安装根证书”。</p>
</blockquote>
<p>总结一下使用SSL证书要注意的问题：</p>
<ul>
<li>1、除非必要，不要随意安装根证书。安装根证书的时候一定要明确证书的来源。</li>
<li>2、对于网银，在线支付，重要邮箱等网站，一定要确保SSL证书是没有问题的，如果浏览器给出SSL证书错误的警告，一定要拒绝访问。一些小区宽带用户一定要注意这点。</li>
<li>3、由于现在个人申请SSL证书比较便宜，一定要注意挂着合法SSL证书的钓鱼网站（国外比较常见）。对于钓鱼网站，一定要看清域名，另外别相信什么中奖的消息，同时要安装带有钓鱼防护功能的安全软件。</li>
</ul>
<h3 id="证书如何保证安全传输"><a href="#证书如何保证安全传输" class="headerlink" title="证书如何保证安全传输"></a>证书如何保证安全传输</h3><p>数字证书包括了加密后服务器的公钥、权威机构的信息、服务器域名，还有经过CA私钥签名之后的证书内容（经过先通过Hash函数计算得到证书数字摘要，然后用权威机构私钥加密数字摘要得到数字签名)，签名计算方法以及证书对应的域名。当客户端收到这个证书之后，使用本地配置的权威机构的公钥对证书进行解密得到服务端的公钥和证书的数字签名，数字签名经过CA公钥解密得到证书信息摘要，然后根据证书上描述的计算证书的方法计算一下当前证书的信息摘要，与收到的信息摘要作对比，如果一样，表示证书一定是服务器下发的，没有被中间人篡改过。因为中间人虽然有权威机构的公钥，能够解析证书内容并篡改，但是篡改完成之后中间人需要将证书重新加密，但是中间人没有权威机构的私钥，无法加密，强行加密只会导致客户端无法解密，如果中间人强行乱修改证书，就会导致证书内容和证书签名不匹配。</p>
<p>那第三方攻击者能否让自己的证书显示出来的信息也是服务端呢？（伪装服务端一样的配置）显然这个是不行的，因为当第三方攻击者去CA那边寻求认证的时候CA会要求其提供例如域名的whois信息、域名管理邮箱等证明你是服务端域名的拥有者，而第三方攻击者是无法提供这些信息所以他就是无法骗CA他拥有属于服务端的域名</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="安全性考虑"><a href="#安全性考虑" class="headerlink" title="安全性考虑"></a>安全性考虑</h3><ol>
<li>HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。</li>
<li>SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。</li>
</ol>
<h3 id="成本考虑"><a href="#成本考虑" class="headerlink" title="成本考虑"></a>成本考虑</h3><p>SSL证书需要购买申请，功能越强大的证书费用越高。</p>
<p>SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名，IPv4资源不可能支撑这个消耗（SSL有扩展可以部分解决这个问题，但是比较麻烦，而且要求浏览器、操作系统支持，Windows XP就不支持这个扩展，考虑到XP的装机量，这个特性几乎没用）。</p>
<p>根据ACM CoNEXT数据显示，使用HTTPS协议会使页面的加载时间延长近50%，增加10%到20%的耗电。</p>
<p>HTTPS连接缓存不如HTTP高效，流量成本高。</p>
<p>HTTPS连接服务器端资源占用高很多，支持访客多的网站需要投入更大的成本。</p>
<p>HTTPS协议握手阶段比较费时，对网站的响应速度有影响，影响用户体验。比较好的方式是采用分而治之，类似12306网站的主页使用HTTP协议，有关于用户信息等方面使用HTTPS。</p>
<h2 id="openssl"><a href="#openssl" class="headerlink" title="openssl"></a>openssl</h2><p>SSL只是一个协议，openssl则是SSL的实现版，另外openssl还包含了公钥私钥的生成、摘要生成等各种工具。</p>
<p><strong>使用场景</strong></p>
<p>我们知道，有些时候我们浏览网站的时候会有一些广告，这些广告什么的不一定是原网站挂上去的，也有可能是中间的运营商在中间篡改了内容导致的，可以使用https技术（一般是基于openssl）来对数据进行加密，保证数据不被篡改。</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p><strong>学习来源</strong></p>
<p><a href="http://www.runoob.com/w3cnote/https-ssl-intro.html" target="_blank" rel="noopener">http://www.runoob.com/w3cnote/https-ssl-intro.html</a></p>
<p><a href="https://blog.csdn.net/xiaoming100001/article/details/81109617" target="_blank" rel="noopener">https://blog.csdn.net/xiaoming100001/article/details/81109617</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Network/">Network</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http/">http</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Macos/clion_git" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/04/01/Macos/clion_git/" class="article-date">
      <time datetime="2019-04-01T07:24:56.000Z" itemprop="datePublished">2019-04-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/01/Macos/clion_git/">clion+git使用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="Clion-Git使用"><a href="#Clion-Git使用" class="headerlink" title="Clion+Git使用"></a>Clion+Git使用</h3><ol>
<li><p>先创建本地仓库并且发布(命令行或者GitHub Desktop)</p>
</li>
<li><p>Clion只需要在上一步创建的位置上创建新项目，便会自动使用Git进行版本控制。</p>
</li>
<li><p>工具栏只能pull和commit，而push在菜单栏里。</p>
</li>
<li><p>如果不想上传clion自动创建的文件夹，可以添加ignore文件名(命令行或者GitHub Desktop)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake-build*</span><br><span class="line">.idea</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>PS：</p>
<ul>
<li>可以设置commit的时候检查todo注释</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/clion/">clion</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2019 Skuaka
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="Site Visitors"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="Page Hits"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 1;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>